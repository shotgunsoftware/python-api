

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>shotgun_api3.shotgun &mdash; python-api v3.7.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href='https://help.autodesk.com/view/SGDEV/ENU/'>
    
        <img style='width: 191px;
                height: 60px;
                margin: 2px;
                border-radius: 0px;
                padding: 0px;'
            src='../../_static/logo_sg@2x.png'/>
    
    </a>
    

          
          
          <a href="../../index.html" class="icon icon-home">
            python-api
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbook.html">API Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced.html">Advanced Topics</a></li>
</ul>


    <a href='genindex.html'>Alphabetic Index</a>

    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px;
                color: #b3b3b3;
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>
    <style>
        a.custom_post_menu { display: inline;
                             padding: 0px;
                             text-decoration: underline; }
    </style>

    <b>python-api</b> v3.7.0.<br>
    
    For more information, please visit
    <a class=custom_post_menu href='https://help.autodesk.com/view/SGDEV/ENU/'>The Flow Production Tracking developer portal.</a>.
    The code associated with this documentation can be found
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/python-api'>here</a>.

    </div>
    <style>
        p.privacy_links { margin: 4px 0px;}
    </style>
    <p class="privacy_links"><a data-opt-in-preferences href="javascript:;">Privacy settings</a></p>
    <p class="privacy_links"><a data-wat-linkname="manage-ccpa-settings-footer-link" href="javascript:;">Do not sell my personal information</a></p>
    <p class="privacy_links"><a href="https://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy/Cookies</a></p>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">python-api</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">shotgun_api3.shotgun</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for shotgun_api3.shotgun</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> -----------------------------------------------------------------------------</span>
<span class="sd"> Copyright (c) 2009-2019, Shotgun Software Inc.</span>

<span class="sd"> Redistribution and use in source and binary forms, with or without</span>
<span class="sd"> modification, are permitted provided that the following conditions are met:</span>

<span class="sd">  - Redistributions of source code must retain the above copyright notice, this</span>
<span class="sd">    list of conditions and the following disclaimer.</span>

<span class="sd">  - Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="sd">    this list of conditions and the following disclaimer in the documentation</span>
<span class="sd">    and/or other materials provided with the distribution.</span>

<span class="sd">  - Neither the name of the Shotgun Software Inc nor the names of its</span>
<span class="sd">    contributors may be used to endorse or promote products derived from this</span>
<span class="sd">    software without specific prior written permission.</span>

<span class="sd"> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="sd"> AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="sd"> IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="sd"> DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="sd"> FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="sd"> DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="sd"> SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="sd"> CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="sd"> OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="sd"> OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Python 2/3 compatibility</span>
<span class="kn">from</span> <span class="nn">.lib</span> <span class="kn">import</span> <span class="n">six</span>
<span class="kn">from</span> <span class="nn">.lib</span> <span class="kn">import</span> <span class="n">sgsix</span>
<span class="kn">from</span> <span class="nn">.lib</span> <span class="kn">import</span> <span class="n">sgutils</span>
<span class="kn">from</span> <span class="nn">.lib.six</span> <span class="kn">import</span> <span class="n">BytesIO</span>               <span class="c1"># used for attachment upload</span>
<span class="kn">from</span> <span class="nn">.lib.six.moves</span> <span class="kn">import</span> <span class="nb">map</span>

<span class="kn">from</span> <span class="nn">.lib.six.moves</span> <span class="kn">import</span> <span class="n">http_cookiejar</span>  <span class="c1"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">uuid</span>                                <span class="c1"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">stat</span>                                <span class="c1"># used for attachment upload</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">.lib.six.moves</span> <span class="kn">import</span> <span class="n">urllib</span>
<span class="kn">import</span> <span class="nn">shutil</span>       <span class="c1"># used for attachment download</span>
<span class="kn">from</span> <span class="nn">.lib.six.moves</span> <span class="kn">import</span> <span class="n">http_client</span>      <span class="c1"># Used for secure file upload.</span>
<span class="kn">from</span> <span class="nn">.lib.httplib2</span> <span class="kn">import</span> <span class="n">Http</span><span class="p">,</span> <span class="n">ProxyInfo</span><span class="p">,</span> <span class="n">socks</span><span class="p">,</span> <span class="n">ssl_error_classes</span>
<span class="kn">from</span> <span class="nn">.lib.sgtimezone</span> <span class="kn">import</span> <span class="n">SgTimezone</span>

<span class="c1"># Import Error and ResponseError (even though they&#39;re unused in this file) since they need</span>
<span class="c1"># to be exposed as part of the API.</span>
<span class="kn">from</span> <span class="nn">.lib.six.moves.xmlrpc_client</span> <span class="kn">import</span> <span class="n">Error</span><span class="p">,</span> <span class="n">ProtocolError</span><span class="p">,</span> <span class="n">ResponseError</span>  <span class="c1"># noqa</span>

<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">encodebytes</span> <span class="k">as</span> <span class="n">base64encode</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">encodestring</span> <span class="k">as</span> <span class="n">base64encode</span>


<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;shotgun_api3&quot;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Logging instance for shotgun_api3</span>

<span class="sd">Provides a logging instance where log messages are sent during execution. This instance has no</span>
<span class="sd">handler associated with it.</span>

<span class="sd">.. seealso:: :ref:`logging`</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">LOG</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_mimetypes_broken</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if this version of Python ships with a broken version of mimetypes</span>

<span class="sd">    :returns: True if the version of mimetypes is broken, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># mimetypes is broken on Windows only and for Python 2.7.0 to 2.7.9 inclusively.</span>
    <span class="c1"># We&#39;re bundling the version from 2.7.10.</span>
    <span class="c1"># See bugs :</span>
    <span class="c1"># http://bugs.python.org/issue9291  &lt;- Fixed in 2.7.7</span>
    <span class="c1"># http://bugs.python.org/issue21652 &lt;- Fixed in 2.7.8</span>
    <span class="c1"># http://bugs.python.org/issue22028 &lt;- Fixed in 2.7.10</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="ow">and</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">)</span>


<span class="k">if</span> <span class="n">_is_mimetypes_broken</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">.lib</span> <span class="kn">import</span> <span class="n">mimetypes</span> <span class="k">as</span> <span class="n">mimetypes</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mimetypes</span>


<span class="c1"># mimetypes imported in version specific imports</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;video/webm&quot;</span><span class="p">,</span> <span class="s2">&quot;.webm&quot;</span><span class="p">)</span>  <span class="c1"># webm and mp4 seem to be missing</span>
<span class="n">mimetypes</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;video/mp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">)</span>    <span class="c1"># from some OS/distros</span>

<span class="n">SG_TIMEZONE</span> <span class="o">=</span> <span class="n">SgTimezone</span><span class="p">()</span>

<span class="n">SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">NO_SSL_VALIDATION</span> <span class="o">=</span> <span class="kc">False</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Turns off hostname matching validation for SSL certificates</span>

<span class="sd">Sometimes there are cases where certificate validation should be disabled. For example, if you</span>
<span class="sd">have a self-signed internal certificate that isn&#39;t included in our certificate bundle, you may</span>
<span class="sd">not require the added security provided by enforcing this.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Version</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;3.7.0&quot;</span>

<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Errors</span>


<div class="viewcode-block" id="ShotgunError"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ShotgunError">[docs]</a><span class="k">class</span> <span class="nc">ShotgunError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base for all Shotgun API Errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ShotgunFileDownloadError"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.ShotgunFileDownloadError">[docs]</a><span class="k">class</span> <span class="nc">ShotgunFileDownloadError</span><span class="p">(</span><span class="n">ShotgunError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception for file download-related errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">ShotgunThumbnailNotReady</span><span class="p">(</span><span class="n">ShotgunError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception for when trying to use a &#39;pending thumbnail&#39; (aka transient thumbnail) in an operation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="Fault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Fault">[docs]</a><span class="k">class</span> <span class="nc">Fault</span><span class="p">(</span><span class="n">ShotgunError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception when server-side exception detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="AuthenticationFault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.AuthenticationFault">[docs]</a><span class="k">class</span> <span class="nc">AuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception when the server side reports an error related to authentication.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="MissingTwoFactorAuthenticationFault"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.MissingTwoFactorAuthenticationFault">[docs]</a><span class="k">class</span> <span class="nc">MissingTwoFactorAuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception when the server side reports an error related to missing two-factor authentication</span>
<span class="sd">    credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">UserCredentialsNotAllowedForSSOAuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception when the server is configured to use SSO. It is not possible to use</span>
<span class="sd">    a username/password pair to authenticate on such server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">UserCredentialsNotAllowedForOxygenAuthenticationFault</span><span class="p">(</span><span class="n">Fault</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception when the server is configured to use Oxygen. It is not possible to use</span>
<span class="sd">    a username/password pair to authenticate on such server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># API</span>


<span class="k">class</span> <span class="nc">ServerCapabilities</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for the servers capabilities, such as version enabled features.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This class is part of the internal API and its interfaces may change at any time in</span>
<span class="sd">        the future. Therefore, usage of this class is discouraged.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ServerCapabilities.__init__</span>

<span class="sd">        :param str host: Host name for the server excluding protocol.</span>
<span class="sd">        :param dict meta: dict of meta data for the server returned from the info() api method.</span>

<span class="sd">        :ivar str host:</span>
<span class="sd">        :ivar dict server_info:</span>
<span class="sd">        :ivar tuple version: Simple version of the Shotgun server. ``(major, minor, rev)``</span>
<span class="sd">        :ivar bool is_dev: ``True`` if server is running a development version of the Shotgun</span>
<span class="sd">            codebase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_python_version_supported</span><span class="p">()</span>
        <span class="c1"># Server host name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span> <span class="o">=</span> <span class="n">meta</span>

        <span class="c1"># Version from server is major.minor.rev or major.minor.rev.&quot;Dev&quot;</span>
        <span class="c1"># Store version as tuple and check dev flag</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;The Flow Production Tracking Server didn&#39;t respond with a version number. &quot;</span>
                               <span class="s2">&quot;This may be because you are running an older version of &quot;</span>
                               <span class="s2">&quot;Flow Production Tracking against a more recent version of the Flow Production Tracking API. &quot;</span>
                               <span class="s2">&quot;For more information, please contact the Autodesk support.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Dev&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_json_supported</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ensure_python_version_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the if current Python version is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;This module requires Python version 3.7 or higher.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">raise_hell</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the server version supports a given feature, raises an exception if it does not.</span>

<span class="sd">        :param dict feature: dict where **version** key contains a 3 integer tuple indicating the</span>
<span class="sd">            supported server version and **label** key contains a human-readable label str::</span>

<span class="sd">                { &#39;version&#39;: (5, 4, 4), &#39;label&#39;: &#39;project parameter }</span>
<span class="sd">        :param bool raise_hell: Whether to raise an exception if the feature is not supported.</span>
<span class="sd">            Defaults to ``True``</span>
<span class="sd">        :raises: :class:`ShotgunError` if the current server version does not support ``feature``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">raise_hell</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> requires server version </span><span class="si">%s</span><span class="s2"> or higher, &quot;</span>
                    <span class="s2">&quot;server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span> <span class="n">_version_str</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]),</span> <span class="n">_version_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_ensure_json_supported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for JSON API endpoint added in v2.4.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON API&quot;</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">ensure_include_archived_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for archived Projects feature added in v5.3.14.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;include_archived_projects parameter&quot;</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">ensure_per_project_customization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for per-project customization feature added in v5.4.4.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;project parameter&quot;</span>
        <span class="p">},</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_support_for_additional_filter_presets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for additional filter presets feature added in v7.0.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;additional_filter_presets parameter&quot;</span>
        <span class="p">},</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_user_following_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for listing items a user is following, added in v7.0.12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;user_following parameter&quot;</span>
        <span class="p">},</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_paging_info_without_counts_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for optimized pagination, added in v7.4.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;optimized pagination&quot;</span>
        <span class="p">},</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_return_image_urls_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures server has support for returning thumbnail URLs without additional round-trips, added in v3.3.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_support</span><span class="p">({</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;return thumbnail URLs&quot;</span>
        <span class="p">},</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ServerCapabilities: host </span><span class="si">%s</span><span class="s2">, version </span><span class="si">%s</span><span class="s2">, is_dev </span><span class="si">%s</span><span class="s2">&quot;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dev</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ClientCapabilities</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for the client capabilities.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This class is part of the internal API and its interfaces may change at any time in</span>
<span class="sd">        the future. Therefore, usage of this class is discouraged.</span>

<span class="sd">    :ivar str platform: The current client platform. Valid values are ``mac``, ``linux``,</span>
<span class="sd">        ``windows``, or ``None`` (if the current platform couldn&#39;t be determined).</span>
<span class="sd">    :ivar str local_path_field: The PTR field used for local file paths. This is calculated using</span>
<span class="sd">        the value of ``platform``. Ex. ``local_path_mac``.</span>
<span class="sd">    :ivar str py_version: Simple version of Python executable as a string. Eg. ``2.7``.</span>
<span class="sd">    :ivar str ssl_version: Version of OpenSSL installed. Eg. ``OpenSSL 1.0.2g  1 Mar 2016``. This</span>
<span class="sd">        info is only available in Python 2.7+ if the ssl module was imported successfully.</span>
<span class="sd">        Defaults to ``unknown``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s2">&quot;mac&quot;</span>
        <span class="k">elif</span> <span class="n">system</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;linux&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s2">&quot;linux&quot;</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s2">&quot;windows&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span> <span class="o">=</span> <span class="s2">&quot;local_path_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">py_version</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># extract the OpenSSL version if we can. The version is only available in Python 2.7 and</span>
        <span class="c1"># only if we successfully imported ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ssl_version</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">OPENSSL_VERSION</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ClientCapabilities: platform </span><span class="si">%s</span><span class="s2">, local_path_field </span><span class="si">%s</span><span class="s2">, &quot;</span>\
            <span class="s2">&quot;py_verison </span><span class="si">%s</span><span class="s2">, ssl version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_path_field</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">py_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssl_version</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for the client configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param sg: Shotgun connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span> <span class="o">=</span> <span class="n">sg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rpc_attempts</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1"># rpc_attempt_interval stores the number of milliseconds to wait between</span>
        <span class="c1"># request retries.  By default, this will be 3000 milliseconds. You can</span>
        <span class="c1"># override this by setting this property on the config like so:</span>
        <span class="c1">#</span>
        <span class="c1">#      sg = Shotgun(site_name, script_name, script_key)</span>
        <span class="c1">#      sg.config.rpc_attempt_interval = 1000 # adjusting default interval</span>
        <span class="c1">#</span>
        <span class="c1"># Or by setting the ``SHOTGUN_API_RETRY_INTERVAL`` environment variable.</span>
        <span class="c1"># In the case that the environment variable is already set, setting the</span>
        <span class="c1"># property on the config will override it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_attempt_interval</span> <span class="o">=</span> <span class="mi">3000</span>
        <span class="c1"># From http://docs.python.org/2.6/library/httplib.html:</span>
        <span class="c1"># If the optional timeout parameter is given, blocking operations</span>
        <span class="c1"># (like connection attempts) will timeout after that many seconds</span>
        <span class="c1"># (if it is not given, the global default timeout setting is used)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout_secs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_ver</span> <span class="o">=</span> <span class="s2">&quot;api3&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_records_per_page</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sudo_as_login</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Authentication parameters to be folded into final auth_params dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_auth_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># uuid as a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_uuid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The raw_http_proxy reflects the exact string passed in</span>
        <span class="c1"># to the Shotgun constructor. This can be useful if you</span>
        <span class="c1"># need to construct a Shotgun API instance based on</span>
        <span class="c1"># another Shotgun API instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_http_proxy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if a proxy server is being used, the proxy_handler</span>
        <span class="c1"># below will contain a urllib2.ProxyHandler instance</span>
        <span class="c1"># which can be used whenever a request needs to be made.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">8080</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_pass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authorization</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localized</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">set_server_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the different server related fields based on the passed in URL.</span>

<span class="sd">        This will impact the following attributes:</span>

<span class="sd">        - scheme: http or https</span>
<span class="sd">        - api_path: usually /api3/json</span>
<span class="sd">        - server: usually something.shotgunstudio.com</span>

<span class="sd">        :param str base_url: The server URL.</span>

<span class="sd">        :raises ValueError: Raised if protocol is not http or https.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">api_base</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
            <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;base_url must use http or https got &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">base_url</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_path</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span>
            <span class="n">api_base</span> <span class="ow">or</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_ver</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">),</span> <span class="s2">&quot;json&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">records_per_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The records per page value from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_records_per_page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Check for api_max_entities_per_page in the server info and change the record per page</span>
            <span class="c1"># value if it is supplied.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_records_per_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sg</span><span class="o">.</span><span class="n">server_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_max_entities_per_page&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">500</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_records_per_page</span>


<div class="viewcode-block" id="Shotgun"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun">[docs]</a><span class="k">class</span> <span class="nc">Shotgun</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shotgun Client connection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># reg ex from</span>
    <span class="c1"># http://underground.infovark.com/2008/07/22/iso-date-validation-regex/</span>
    <span class="c1"># Note a length check is done before checking the reg ex</span>
    <span class="n">_DATE_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;^(\d</span><span class="si">{4}</span><span class="s2">)\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$&quot;</span><span class="p">)</span>
    <span class="n">_DATE_TIME_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;^(\d</span><span class="si">{4}</span><span class="s2">)\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])&quot;</span>
        <span class="sa">r</span><span class="s2">&quot;(\D?([01]\d|2[0-3])\D?([0-5]\d)\D?([0-5]\d)?\D?(\d</span><span class="si">{3}</span><span class="s2">)?)?$&quot;</span><span class="p">)</span>

    <span class="n">_MULTIPART_UPLOAD_CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">20000000</span>
    <span class="n">MAX_ATTEMPTS</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c1"># Retries on failure</span>
    <span class="n">BACKOFF</span> <span class="o">=</span> <span class="mf">0.75</span>      <span class="c1"># Seconds to wait before retry, times the attempt number</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">base_url</span><span class="p">,</span>
                 <span class="n">script_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">api_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">convert_datetimes_to_utc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">http_proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">connect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">ca_certs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">login</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sudo_as_login</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">session_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">auth_token</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new instance of the Shotgun client.</span>

<span class="sd">        :param str base_url: http or https url of the Shotgun server. Do not include the trailing</span>
<span class="sd">            slash::</span>

<span class="sd">                https://example.shotgunstudio.com</span>
<span class="sd">        :param str script_name: name of the Script entity used to authenticate to the server.</span>
<span class="sd">            If provided, then ``api_key`` must be as well, and neither ``login`` nor ``password``</span>
<span class="sd">            can be provided.</span>

<span class="sd">            .. seealso:: :ref:`authentication`</span>
<span class="sd">        :param str api_key: API key for the provided ``script_name``. Used to authenticate to the</span>
<span class="sd">            server.  If provided, then ``script_name`` must be as well, and neither ``login`` nor</span>
<span class="sd">            ``password`` can be provided.</span>

<span class="sd">            .. seealso:: :ref:`authentication`</span>
<span class="sd">        :param bool convert_datetimes_to_utc: (optional) When ``True``, datetime values are converted</span>
<span class="sd">            from local time to UTC time before being sent to the server. Datetimes received from</span>
<span class="sd">            the server are then converted back to local time. When ``False`` the client should use</span>
<span class="sd">            UTC date time values. Default is ``True``.</span>
<span class="sd">        :param str http_proxy: (optional) URL for a proxy server to use for all connections. The</span>
<span class="sd">            expected str format is ``[username:password@]111.222.333.444[:8080]``. Examples::</span>

<span class="sd">                192.168.0.1</span>
<span class="sd">                192.168.0.1:8888</span>
<span class="sd">                joe:user@192.168.0.1:8888</span>
<span class="sd">        :param bool connect: (optional) When ``True``, as soon as the :class:`~shotgun_api3.Shotgun`</span>
<span class="sd">            instance is created, a connection will be made to the Shotgun server to determine the</span>
<span class="sd">            server capabilities and confirm this version of the client is compatible with the server</span>
<span class="sd">            version. This is mostly used for testing. Default is ``True``.</span>
<span class="sd">        :param str ca_certs: (optional) path to an external SSL certificates file. By default, the</span>
<span class="sd">            Shotgun API will use its own built-in certificates file which stores root certificates</span>
<span class="sd">            for the most common Certificate Authorities (CAs). If you are using a corporate or</span>
<span class="sd">            internal CA, or are packaging an application into an executable, it may be necessary to</span>
<span class="sd">            point to your own certificates file. You can do this by passing in the full path to the</span>
<span class="sd">            file via this parameter or by setting the environment variable ``SHOTGUN_API_CACERTS``.</span>
<span class="sd">            In the case both are set, this parameter will take precedence.</span>
<span class="sd">        :param str login: The user login str to use to authenticate to the server when using user-based</span>
<span class="sd">            authentication. If provided, then ``password`` must be as well, and neither</span>
<span class="sd">            ``script_name`` nor ``api_key`` can be provided.</span>

<span class="sd">            .. seealso:: :ref:`authentication`</span>
<span class="sd">        :param str password: The password str to use to authenticate to the server when using user-based</span>
<span class="sd">            authentication. If provided, then ``login`` must be as well and neither ``script_name``</span>
<span class="sd">            nor ``api_key`` can be provided.</span>

<span class="sd">            See :ref:`authentication` for more info.</span>
<span class="sd">        :param str sudo_as_login: A user login string for the user whose permissions will be applied</span>
<span class="sd">            to all actions. Event log entries will be generated showing this user performing all</span>
<span class="sd">            actions with an additional extra meta-data parameter ``sudo_actual_user`` indicating the</span>
<span class="sd">            script or user that is actually authenticated.</span>
<span class="sd">        :param str session_token: The session token to use to authenticate to the server. This</span>
<span class="sd">            can be used as an alternative to authenticating with a script user or regular user.</span>
<span class="sd">            You can retrieve the session token by running the</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.get_session_token()` method.</span>

<span class="sd">            .. todo: Add this info to the Authentication section of the docs</span>
<span class="sd">        :param str auth_token: The authentication token required to authenticate to a server with</span>
<span class="sd">            two-factor authentication turned on. If provided, then ``login`` and ``password`` must</span>
<span class="sd">            be provided as well, and neither ``script_name`` nor ``api_key`` can be provided.</span>

<span class="sd">            .. note:: These tokens can be short lived so a session is established right away if an</span>
<span class="sd">                ``auth_token`` is provided. A</span>
<span class="sd">                :class:`~shotgun_api3.MissingTwoFactorAuthenticationFault` will be raised if the</span>
<span class="sd">                ``auth_token`` is invalid.</span>
<span class="sd">            .. todo: Add this info to the Authentication section of the docs</span>

<span class="sd">        .. note:: A note about proxy connections: If you are using Python &lt;= v2.6.2, HTTPS</span>
<span class="sd">            connections through a proxy server will not work due to a bug in the :mod:`urllib2`</span>
<span class="sd">            library (see http://bugs.python.org/issue1424152). This will affect upload and</span>
<span class="sd">            download-related methods in the Shotgun API (eg. :meth:`~shotgun_api3.Shotgun.upload`,</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.upload_thumbnail`,</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.upload_filmstrip_thumbnail`,</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.download_attachment`. Normal CRUD methods for passing JSON</span>
<span class="sd">            data should still work fine. If you cannot upgrade your Python installation, you can see</span>
<span class="sd">            the patch merged into Python v2.6.3 (http://hg.python.org/cpython/rev/0f57b30a152f/) and</span>
<span class="sd">            try and hack it into your installation but YMMV. For older versions of Python there</span>
<span class="sd">            are other patches that were proposed in the bug report that may help you as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># verify authentication arguments</span>
        <span class="k">if</span> <span class="n">session_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot provide both session_token &quot;</span>
                                 <span class="s2">&quot;and script_name/api_key&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot provide both session_token &quot;</span>
                                 <span class="s2">&quot;and login/password&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot provide both login/password &quot;</span>
                                 <span class="s2">&quot;and script_name/api_key&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;password provided without login&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;login provided without password&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;api_key provided without script_name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;script_name provided without api_key&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">auth_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">login</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must provide a user login and password with an auth_token&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">script_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot provide an auth_code with script_name/api_key&quot;</span><span class="p">)</span>

        <span class="c1"># Can&#39;t use &#39;all&#39; with python 2.4</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">session_token</span><span class="p">,</span> <span class="n">script_name</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must provide login/password, session_token or script_name/api_key&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">_Config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span> <span class="o">=</span> <span class="n">script_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="n">session_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span> <span class="o">=</span> <span class="n">sudo_as_login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span> <span class="o">=</span> <span class="n">convert_datetimes_to_utc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="o">=</span> <span class="n">NO_SSL_VALIDATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">raw_http_proxy</span> <span class="o">=</span> <span class="n">http_proxy</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rpc_attempt_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SHOTGUN_API_RETRY_INTERVAL&quot;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">retry_interval</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SHOTGUN_API_RETRY_INTERVAL&quot;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value &#39;</span><span class="si">%s</span><span class="s2">&#39; found in environment variable &quot;</span>
                             <span class="s2">&quot;SHOTGUN_API_RETRY_INTERVAL, must be int.&quot;</span> <span class="o">%</span> <span class="n">retry_interval</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rpc_attempt_interval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value of SHOTGUN_API_RETRY_INTERVAL must be positive, &quot;</span>
                             <span class="s2">&quot;got &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rpc_attempt_interval</span><span class="p">)</span>
        
        <span class="k">global</span> <span class="n">SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_certs_file</span><span class="p">(</span><span class="n">ca_certs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_url</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set_server_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>

        <span class="c1"># if the service contains user information strip it out</span>
        <span class="c1"># copied from the xmlrpclib which turned the user:password into</span>
        <span class="c1"># and auth header</span>

        <span class="c1"># Do NOT self._split_url(self.base_url) here, as it contains the lower</span>
        <span class="c1"># case version of the base_url argument. Doing so would base64encode</span>
        <span class="c1"># the lowercase version of the credentials.</span>
        <span class="n">auth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_url</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auth</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="n">base64encode</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span>
                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">auth</span><span class="p">)))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span> <span class="o">=</span> <span class="s2">&quot;Basic &quot;</span> <span class="o">+</span> <span class="n">auth</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># foo:bar@123.456.789.012:3456</span>
        <span class="k">if</span> <span class="n">http_proxy</span><span class="p">:</span>
            <span class="c1"># check if we&#39;re using authentication. Start from the end since</span>
            <span class="c1"># there might be @ in the user&#39;s password.</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">http_proxy</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span> <span class="o">=</span> \
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">proxy_server</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proxy_server</span> <span class="o">=</span> <span class="n">http_proxy</span>
            <span class="n">proxy_netloc_list</span> <span class="o">=</span> <span class="n">proxy_server</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span> <span class="o">=</span> <span class="n">proxy_netloc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">proxy_netloc_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_netloc_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid http_proxy address &#39;</span><span class="si">%s</span><span class="s2">&#39;. Valid &quot;</span>
                                     <span class="s2">&quot;format is &#39;123.456.789.012&#39; or &#39;123.456.789.012:3456&#39;&quot;</span>
                                     <span class="s2">&quot;. If no port is specified, a default of </span><span class="si">%d</span><span class="s2"> will be &quot;</span>
                                     <span class="s2">&quot;used.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">http_proxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">))</span>

            <span class="c1"># now populate self.config.proxy_handler</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">:</span>
                <span class="n">auth_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">@&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">auth_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">proxy_addr</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">auth_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span> <span class="n">proxy_addr</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">ensure_ascii</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads_ascii</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span> <span class="o">=</span> <span class="n">ClientCapabilities</span><span class="p">()</span>
        <span class="c1"># this relies on self.client_caps being set first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_user_agent</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># test to ensure the the server supports the json API</span>
        <span class="c1"># call to server will only be made once and will raise error</span>
        <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span>

        <span class="c1"># When using auth_token in a 2FA scenario we need to switch to session-based</span>
        <span class="c1"># authentication because the auth token will no longer be valid after a first use.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session_token</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_split_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the hostname:port and username/password/token from base_url</span>
<span class="sd">        sent when connect to the API.</span>

<span class="sd">        In python 3.8 `urllib.parse.splituser` was deprecated warning devs to</span>
<span class="sd">        use `urllib.parse.urlparse`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY38</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">hostname</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">port</span><span class="p">:</span>
                <span class="n">server</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">username</span><span class="p">:</span>
                <span class="n">auth</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">username</span>

                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
                    <span class="n">auth</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">auth</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">splituser</span><span class="p">(</span>
                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">auth</span><span class="p">,</span> <span class="n">server</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># API Functions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property containing server information.</span>

<span class="sd">        &gt;&gt;&gt; sg.server_info</span>
<span class="sd">        {&#39;full_version&#39;: [6, 3, 15, 0], &#39;version&#39;: [6, 3, 15], ...}</span>

<span class="sd">        .. note::</span>

<span class="sd">            Beyond ``full_version`` and ``version`` which differ by the inclusion of the bugfix number,</span>
<span class="sd">            you should expect these values to be unsupported and for internal use only.</span>

<span class="sd">        :returns: dict of server information from :class:`ServerCapabilities` object</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">server_info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_caps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property containing :class:`ServerCapabilities` object.</span>

<span class="sd">        &gt;&gt;&gt; sg.server_caps</span>
<span class="sd">        &lt;shotgun_api3.shotgun.ServerCapabilities object at 0x10120d350&gt;</span>

<span class="sd">        :returns: :class:`ServerCapabilities` object that describe the server the client is</span>
<span class="sd">            connected to.</span>
<span class="sd">        :rtype: :class:`ServerCapabilities` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span><span class="o">.</span><span class="n">host</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span> <span class="o">=</span> <span class="n">ServerCapabilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_caps</span>

<div class="viewcode-block" id="Shotgun.connect"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect client to the server if it is not already connected.</span>

<span class="sd">        .. note:: The client will automatically connect to the server on demand. You only need to</span>
<span class="sd">            call this function if you wish to confirm the client can connect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Shotgun.close"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the current connection to the server.</span>

<span class="sd">        If the client needs to connect again it will do so automatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Shotgun.info"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get API-related metadata from the Shotgun server.</span>

<span class="sd">        &gt;&gt;&gt; sg.info()</span>
<span class="sd">        {&#39;full_version&#39;: [8, 2, 1, 0], &#39;version&#39;: [8, 2, 1], &#39;user_authentication_method&#39;: &#39;default&#39;, ...}</span>

<span class="sd">        ::</span>

<span class="sd">            Token                       Value</span>
<span class="sd">            --------                    ---------</span>
<span class="sd">            full_version                An ordered array of the full Shotgun version.</span>
<span class="sd">                                        [major, minor, patch, hotfix]</span>
<span class="sd">            version                     An ordered array of the Shotgun version.</span>
<span class="sd">                                        [major, minor, patch]</span>
<span class="sd">            user_authentication_method  Indicates the authentication method used by Shotgun.</span>
<span class="sd">                                        Will be one of the following values:</span>
<span class="sd">                                            default: regular username/password.</span>
<span class="sd">                                            ldap:    username/password from the company&#39;s LDAP.</span>
<span class="sd">                                            saml2:   SSO used, over SAML2.</span>

<span class="sd">        .. note::</span>

<span class="sd">            Beyond the documented tokens, you should expect</span>
<span class="sd">            the other values to be unsupported and for internal use only.</span>

<span class="sd">        :returns: dict of the server metadata.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.find_one"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.find_one">[docs]</a>    <span class="k">def</span> <span class="nf">find_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_operator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retired_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">include_archived_projects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_filter_presets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shortcut for :meth:`~shotgun_api3.Shotgun.find` with ``limit=1`` so it returns a single</span>
<span class="sd">        result.</span>

<span class="sd">            &gt;&gt;&gt; sg.find_one(&quot;Asset&quot;, [[&quot;id&quot;, &quot;is&quot;, 32]], [&quot;id&quot;, &quot;code&quot;, &quot;sg_status_list&quot;])</span>
<span class="sd">            {&#39;code&#39;: &#39;Gopher&#39;, &#39;id&#39;: 32, &#39;sg_status_list&#39;: &#39;ip&#39;, &#39;type&#39;: &#39;Asset&#39;}</span>

<span class="sd">        :param str entity_type: Shotgun entity type as a string to find.</span>
<span class="sd">        :param list filters: list of filters to apply to the query.</span>

<span class="sd">            .. seealso:: :ref:`filter_syntax`</span>

<span class="sd">        :param list fields: Optional list of fields to include in each entity record returned.</span>
<span class="sd">            Defaults to ``[&quot;id&quot;]``.</span>
<span class="sd">        :param int order: Optional list of fields to order the results by. List has the format::</span>

<span class="sd">                [</span>
<span class="sd">                    {&#39;field_name&#39;:&#39;foo&#39;, &#39;direction&#39;:&#39;asc&#39;},</span>
<span class="sd">                    {&#39;field_name&#39;:&#39;bar&#39;, &#39;direction&#39;:&#39;desc&#39;}</span>
<span class="sd">                ]</span>

<span class="sd">            Defaults to sorting by ``id`` in ascending order.</span>
<span class="sd">        :param str filter_operator: Operator to apply to the filters. Supported values are ``&quot;all&quot;``</span>
<span class="sd">            and ``&quot;any&quot;``. These are just another way of defining if the query is an AND or OR</span>
<span class="sd">            query. Defaults to ``&quot;all&quot;``.</span>
<span class="sd">        :param bool retired_only: Optional boolean when ``True`` will return only entities that have</span>
<span class="sd">            been retired. Defaults to ``False`` which returns only entities which have not been</span>
<span class="sd">            retired. There is no option to return both retired and non-retired entities in the</span>
<span class="sd">            same query.</span>
<span class="sd">        :param bool include_archived_projects: Optional boolean flag to include entities whose projects</span>
<span class="sd">            have been archived. Defaults to ``True``.</span>
<span class="sd">        :param additional_filter_presets: Optional list of presets to further filter the result</span>
<span class="sd">            set, list has the form::</span>

<span class="sd">                [{</span>
<span class="sd">                    &quot;preset_name&quot;: &lt;preset_name&gt;,</span>
<span class="sd">                    &lt;optional_param1&gt;: &lt;optional_value1&gt;,</span>
<span class="sd">                    ...</span>
<span class="sd">                }]</span>

<span class="sd">            Note that these filters are ANDed together and ANDed with the &#39;filter&#39;</span>
<span class="sd">            argument.</span>

<span class="sd">            For details on supported presets and the format of this parameter see</span>
<span class="sd">            :ref:`additional_filter_presets`</span>
<span class="sd">        :returns: Dictionary representing a single matching entity with the requested fields,</span>
<span class="sd">            and the defaults ``&quot;id&quot;`` and ``&quot;type&quot;`` which are always included.</span>

<span class="sd">            .. seealso:: :ref:`entity-fields`</span>

<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">retired_only</span><span class="p">,</span>
                            <span class="n">include_archived_projects</span><span class="o">=</span><span class="n">include_archived_projects</span><span class="p">,</span>
                            <span class="n">additional_filter_presets</span><span class="o">=</span><span class="n">additional_filter_presets</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Shotgun.find"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_operator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">retired_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">include_archived_projects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">additional_filter_presets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find entities matching the given filters.</span>

<span class="sd">            &gt;&gt;&gt; # Find Character Assets in Sequence 100_FOO</span>
<span class="sd">            &gt;&gt;&gt; # -------------</span>
<span class="sd">            &gt;&gt;&gt; fields = [&#39;id&#39;, &#39;code&#39;, &#39;sg_asset_type&#39;]</span>
<span class="sd">            &gt;&gt;&gt; sequence_id = 2 # Sequence &quot;100_FOO&quot;</span>
<span class="sd">            &gt;&gt;&gt; project_id = 4 # Demo Project</span>
<span class="sd">            &gt;&gt;&gt; filters = [</span>
<span class="sd">            ...     [&#39;project&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: project_id}],</span>
<span class="sd">            ...     [&#39;sg_asset_type&#39;, &#39;is&#39;, &#39;Character&#39;],</span>
<span class="sd">            ...     [&#39;sequences&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Sequence&#39;, &#39;id&#39;: sequence_id}]</span>
<span class="sd">            ... ]</span>
<span class="sd">            &gt;&gt;&gt; assets= sg.find(&quot;Asset&quot;,filters,fields)</span>
<span class="sd">            [{&#39;code&#39;: &#39;Gopher&#39;, &#39;id&#39;: 32, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Cow&#39;, &#39;id&#39;: 33, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Bird_1&#39;, &#39;id&#39;: 35, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Bird_2&#39;, &#39;id&#39;: 36, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Bird_3&#39;, &#39;id&#39;: 37, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Raccoon&#39;, &#39;id&#39;: 45, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;Wet Gopher&#39;, &#39;id&#39;: 149, &#39;sg_asset_type&#39;: &#39;Character&#39;, &#39;type&#39;: &#39;Asset&#39;}]</span>

<span class="sd">        You can drill through single entity links to filter on fields or display linked fields.</span>
<span class="sd">        This is often called &quot;deep linking&quot; or using &quot;dot notation&quot;.</span>

<span class="sd">            .. seealso:: :ref:`filter_syntax`</span>

<span class="sd">            &gt;&gt;&gt; # Find Versions created by Tasks in the Animation Pipeline Step</span>
<span class="sd">            &gt;&gt;&gt; # -------------</span>
<span class="sd">            &gt;&gt;&gt; fields = [&#39;id&#39;, &#39;code&#39;]</span>
<span class="sd">            &gt;&gt;&gt; pipeline_step_id = 2 # Animation Step ID</span>
<span class="sd">            &gt;&gt;&gt; project_id = 4 # Demo Project</span>
<span class="sd">            &gt;&gt;&gt; # you can drill through single-entity link fields</span>
<span class="sd">            &gt;&gt;&gt; filters = [</span>
<span class="sd">            ...     [&#39;project&#39;,&#39;is&#39;, {&#39;type&#39;: &#39;Project&#39;,&#39;id&#39;: project_id}],</span>
<span class="sd">            ...     [&#39;sg_task.Task.step.Step.id&#39;, &#39;is&#39;, pipeline_step_id]</span>
<span class="sd">            &gt;&gt;&gt; ]</span>
<span class="sd">            &gt;&gt;&gt; sg.find(&quot;Version&quot;, filters, fields)</span>
<span class="sd">            [{&#39;code&#39;: &#39;scene_010_anim_v001&#39;, &#39;id&#39;: 42, &#39;type&#39;: &#39;Version&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;scene_010_anim_v002&#39;, &#39;id&#39;: 134, &#39;type&#39;: &#39;Version&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;bird_v001&#39;, &#39;id&#39;: 137, &#39;type&#39;: &#39;Version&#39;},</span>
<span class="sd">             {&#39;code&#39;: &#39;birdAltBlue_v002&#39;, &#39;id&#39;: 236, &#39;type&#39;: &#39;Version&#39;}]</span>

<span class="sd">        :param str entity_type: Shotgun entity type to find.</span>
<span class="sd">        :param list filters: list of filters to apply to the query.</span>

<span class="sd">            .. seealso:: :ref:`filter_syntax`, :ref:`combining-related-queries`</span>

<span class="sd">        :param list fields: Optional list of fields to include in each entity record returned.</span>
<span class="sd">            Defaults to ``[&quot;id&quot;]``.</span>

<span class="sd">            .. seealso:: :ref:`combining-related-queries`</span>
<span class="sd">            </span>
<span class="sd">        :param list order: Optional list of dictionaries defining how to order the results of the</span>
<span class="sd">            query. Each dictionary contains the ``field_name`` to order by and  the ``direction``</span>
<span class="sd">            to sort::</span>

<span class="sd">                [</span>
<span class="sd">                    {&#39;field_name&#39;:&#39;foo&#39;, &#39;direction&#39;:&#39;asc&#39;},</span>
<span class="sd">                    {&#39;field_name&#39;:&#39;bar&#39;, &#39;direction&#39;:&#39;desc&#39;}</span>
<span class="sd">                ]</span>

<span class="sd">            Defaults to sorting by ``id`` in ascending order.</span>
<span class="sd">        :param str filter_operator: Operator to apply to the filters. Supported values are ``&quot;all&quot;``</span>
<span class="sd">            and ``&quot;any&quot;``. These are just another way of defining if the query is an AND or OR</span>
<span class="sd">            query. Defaults to ``&quot;all&quot;``.</span>
<span class="sd">        :param int limit: Optional limit to the number of entities to return. Defaults to ``0`` which</span>
<span class="sd">            returns all entities that match.</span>
<span class="sd">        :param int page: Optional page of results to return. Use this together with the ``limit``</span>
<span class="sd">            parameter to control how your query results are paged. Defaults to ``0`` which returns</span>
<span class="sd">            all entities that match.</span>
<span class="sd">        :param bool retired_only: Optional boolean when ``True`` will return only entities that have</span>
<span class="sd">            been retired. Defaults to ``False`` which returns only entities which have not been</span>
<span class="sd">            retired. There is no option to return both retired and non-retired entities in the</span>
<span class="sd">            same query.</span>
<span class="sd">        :param bool include_archived_projects: Optional boolean flag to include entities whose projects</span>
<span class="sd">            have been archived. Defaults to ``True``.</span>
<span class="sd">        :param additional_filter_presets: Optional list of presets to further filter the result</span>
<span class="sd">            set, list has the form::</span>

<span class="sd">                [{</span>
<span class="sd">                    &quot;preset_name&quot;: &lt;preset_name&gt;,</span>
<span class="sd">                    &lt;optional_param1&gt;: &lt;optional_value1&gt;,</span>
<span class="sd">                    ...</span>
<span class="sd">                }]</span>

<span class="sd">            Note that these filters are ANDed together and ANDed with the &#39;filter&#39;</span>
<span class="sd">            argument.</span>

<span class="sd">            For details on supported presets and the format of this parameter see</span>
<span class="sd">            :ref:`additional_filter_presets`</span>
<span class="sd">        :returns: list of dictionaries representing each entity with the requested fields, and the</span>
<span class="sd">            defaults ``&quot;id&quot;`` and ``&quot;type&quot;`` which are always included.</span>

<span class="sd">            .. seealso:: :ref:`entity-fields`</span>

<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;limit parameter must be a positive integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page parameter must be a positive integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filter_operator</span><span class="p">:</span>
            <span class="c1"># TODO: Not sure if this test is correct, replicated from prev api</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Deprecated: Use of filter_operator for find() is not valid any more.&quot;</span>
                               <span class="s2">&quot; See the documentation on find()&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_archived_projects</span><span class="p">:</span>
            <span class="c1"># This defaults to True on the server (no argument is sent)</span>
            <span class="c1"># So we only need to check the server version if it is False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_include_archived_projects</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">additional_filter_presets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_support_for_additional_filter_presets</span><span class="p">()</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_read_parameters</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span>
                                                 <span class="n">fields</span><span class="p">,</span>
                                                 <span class="n">filters</span><span class="p">,</span>
                                                 <span class="n">retired_only</span><span class="p">,</span>
                                                 <span class="n">order</span><span class="p">,</span>
                                                 <span class="n">include_archived_projects</span><span class="p">,</span>
                                                 <span class="n">additional_filter_presets</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_return_image_urls_support</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;api_return_image_urls&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_paging_info_without_counts_support</span><span class="p">():</span>
            <span class="n">paging_info_param</span> <span class="o">=</span> <span class="s2">&quot;return_paging_info_without_counts&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paging_info_param</span> <span class="o">=</span> <span class="s2">&quot;return_paging_info&quot;</span>

        <span class="n">params</span><span class="p">[</span><span class="n">paging_info_param</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="n">limit</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">records_per_page</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;entities_per_page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="c1"># If page isn&#39;t set and the limit doesn&#39;t require pagination,</span>
            <span class="c1"># then trigger the faster code path.</span>
            <span class="k">if</span> <span class="n">page</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># if page is specified, then only return the page of records requested</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;current_page&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
            <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

        <span class="n">params</span><span class="p">[</span><span class="n">paging_info_param</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_paging_info_without_counts_support</span><span class="p">():</span>
            <span class="n">has_next_page</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">has_next_page</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
                <span class="n">records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                    <span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
                    <span class="k">break</span>

                <span class="n">has_next_page</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;paging_info&quot;</span><span class="p">][</span><span class="s2">&quot;has_next_page&quot;</span><span class="p">]</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;current_page&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">):</span>
                <span class="n">records</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                    <span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;paging_info&quot;</span><span class="p">][</span><span class="s2">&quot;entity_count&quot;</span><span class="p">]:</span>
                    <span class="k">break</span>

                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">][</span><span class="s2">&quot;current_page&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_construct_read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">entity_type</span><span class="p">,</span>
                                   <span class="n">fields</span><span class="p">,</span>
                                   <span class="n">filters</span><span class="p">,</span>
                                   <span class="n">retired_only</span><span class="p">,</span>
                                   <span class="n">order</span><span class="p">,</span>
                                   <span class="n">include_archived_projects</span><span class="p">,</span>
                                   <span class="n">additional_filter_presets</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_type</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;return_fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;return_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">retired_only</span> <span class="ow">and</span> <span class="s2">&quot;retired&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;active&quot;</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;paging&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;entities_per_page&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">records_per_page</span><span class="p">,</span>
                            <span class="s2">&quot;current_page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">additional_filter_presets</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;additional_filter_presets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_filter_presets</span>

        <span class="k">if</span> <span class="n">include_archived_projects</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Defaults to True on the server, so only pass it if it&#39;s False</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;include_archived_projects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">order</span><span class="p">:</span>
            <span class="n">sort_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sort</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;column&quot;</span> <span class="ow">in</span> <span class="n">sort</span><span class="p">:</span>
                    <span class="c1"># TODO: warn about deprecation of &#39;column&#39; param name</span>
                    <span class="n">sort</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort</span><span class="p">[</span><span class="s2">&quot;column&quot;</span><span class="p">]</span>
                <span class="n">sort</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;direction&quot;</span><span class="p">,</span> <span class="s2">&quot;asc&quot;</span><span class="p">)</span>
                <span class="n">sort_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">sort</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="n">sort</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span>
                <span class="p">})</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sorts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_list</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">_add_project_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">project_entity</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_per_project_customization</span><span class="p">():</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_entity</span>

        <span class="k">return</span> <span class="n">params</span>

<div class="viewcode-block" id="Shotgun.summarize"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.summarize">[docs]</a>    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">entity_type</span><span class="p">,</span>
                  <span class="n">filters</span><span class="p">,</span>
                  <span class="n">summary_fields</span><span class="p">,</span>
                  <span class="n">filter_operator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">grouping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">include_archived_projects</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarize field data returned by a query.</span>

<span class="sd">        This provides the same functionality as the summaries in the UI. You can specify one or</span>
<span class="sd">        more fields to summarize, choose the summary type for each, and optionally group the</span>
<span class="sd">        results which will return summary information for each group as well as the total for</span>
<span class="sd">        the query.</span>

<span class="sd">        **Example: Count all Assets for a Project**</span>

<span class="sd">        &gt;&gt;&gt; sg.summarize(entity_type=&#39;Asset&#39;,</span>
<span class="sd">        ...              filters = [[&#39;project&#39;, &#39;is&#39;, {&#39;type&#39;:&#39;Project&#39;, &#39;id&#39;:4}]],</span>
<span class="sd">        ...              summary_fields=[{&#39;field&#39;:&#39;id&#39;, &#39;type&#39;:&#39;count&#39;}])</span>
<span class="sd">        {&#39;groups&#39;: [], &#39;summaries&#39;: {&#39;id&#39;: 15}}</span>

<span class="sd">        ``summaries`` contains the total summary for the query. Each key is the field summarized</span>
<span class="sd">        and the value is the result of the summary operation for the entire result set.</span>

<span class="sd">        .. note::</span>
<span class="sd">            You cannot perform more than one summary on a field at a time, but you can summarize</span>
<span class="sd">            several different fields in the same call.</span>

<span class="sd">        **Example: Count all Assets for a Project, grouped by sg_asset_type**</span>

<span class="sd">        &gt;&gt;&gt; sg.summarize(entity_type=&#39;Asset&#39;,</span>
<span class="sd">        ...              filters=[[&#39;project&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: 4}]],</span>
<span class="sd">        ...              summary_fields=[{&#39;field&#39;: &#39;id&#39;, &#39;type&#39;: &#39;count&#39;}],</span>
<span class="sd">        ...              grouping=[{&#39;field&#39;: &#39;sg_asset_type&#39;, &#39;type&#39;: &#39;exact&#39;, &#39;direction&#39;: &#39;asc&#39;}])</span>
<span class="sd">        {&#39;groups&#39;: [{&#39;group_name&#39;: &#39;Character&#39;,&#39;group_value&#39;: &#39;Character&#39;, &#39;summaries&#39;: {&#39;id&#39;: 3}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;Environment&#39;,&#39;group_value&#39;: &#39;Environment&#39;, &#39;summaries&#39;: {&#39;id&#39;: 3}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;Matte Painting&#39;, &#39;group_value&#39;: &#39;Matte Painting&#39;, &#39;summaries&#39;: {&#39;id&#39;: 1}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;Prop&#39;, &#39;group_value&#39;: &#39;Prop&#39;, &#39;summaries&#39;: {&#39;id&#39;: 4}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;Vehicle&#39;, &#39;group_value&#39;: &#39;Vehicle&#39;, &#39;summaries&#39;: {&#39;id&#39;: 4}}],</span>
<span class="sd">         &#39;summaries&#39;: {&#39;id&#39;: 15}}</span>

<span class="sd">        - ``summaries`` contains the total summary for the query.</span>
<span class="sd">        - ``groups`` contains the summary for each group.</span>

<span class="sd">            - ``group_name`` is the display name for the group.</span>
<span class="sd">            - ``group_value`` is the actual value of the grouping value. This is often the same as</span>
<span class="sd">              ``group_name`` but in the case when grouping by entity, the ``group_name`` may be</span>
<span class="sd">              ``PuppyA`` and the group_value would be</span>
<span class="sd">              ``{&#39;type&#39;:&#39;Asset&#39;,&#39;id&#39;:922,&#39;name&#39;:&#39;PuppyA&#39;}``.</span>
<span class="sd">            - ``summaries`` contains the summary calculation dict for each field requested.</span>

<span class="sd">        **Example: Count all Tasks for a Sequence and find the latest due_date**</span>

<span class="sd">        &gt;&gt;&gt; sg.summarize(entity_type=&#39;Task&#39;,</span>
<span class="sd">        ...              filters = [</span>
<span class="sd">        ...                 [&#39;entity.Shot.sg_sequence&#39;, &#39;is&#39;, {&#39;type&#39;:&#39;Sequence&#39;, &#39;id&#39;:2}],</span>
<span class="sd">        ...                 [&#39;sg_status_list&#39;, &#39;is_not&#39;, &#39;na&#39;]],</span>
<span class="sd">        ...              summary_fields=[{&#39;field&#39;:&#39;id&#39;, &#39;type&#39;:&#39;count&#39;},</span>
<span class="sd">        ...                              {&#39;field&#39;:&#39;due_date&#39;,&#39;type&#39;:&#39;latest&#39;}])</span>
<span class="sd">        {&#39;groups&#39;: [], &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 30}}</span>

<span class="sd">        This shows that the there are 30 Tasks for Shots in the Sequence and the latest ``due_date``</span>
<span class="sd">        of any Task is ``2013-07-05``.</span>

<span class="sd">        **Example: Count all Tasks for a Sequence, find the latest due_date and group by Shot**</span>

<span class="sd">        &gt;&gt;&gt; sg.summarize(entity_type=&#39;Task&#39;,</span>
<span class="sd">        ...              filters = [</span>
<span class="sd">        ...                 [&#39;entity.Shot.sg_sequence&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Sequence&#39;, &#39;id&#39;: 2}],</span>
<span class="sd">        ...                 [&#39;sg_status_list&#39;, &#39;is_not&#39;, &#39;na&#39;]],</span>
<span class="sd">        ...              summary_fields=[{&#39;field&#39;: &#39;id&#39;, &#39;type&#39;: &#39;count&#39;}, {&#39;field&#39;: &#39;due_date&#39;, &#39;type&#39;: &#39;latest&#39;}],</span>
<span class="sd">        ...              grouping=[{&#39;field&#39;: &#39;entity&#39;, &#39;type&#39;: &#39;exact&#39;, &#39;direction&#39;: &#39;asc&#39;}]))</span>
<span class="sd">        {&#39;groups&#39;: [{&#39;group_name&#39;: &#39;shot_010&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 2, &#39;name&#39;: &#39;shot_010&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-18&#39;, &#39;id&#39;: 10}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;shot_020&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 3, &#39;name&#39;: &#39;shot_020&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-28&#39;, &#39;id&#39;: 10}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;shot_030&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 4, &#39;name&#39;: &#39;shot_030&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 10}}],</span>
<span class="sd">         &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 30}}</span>

<span class="sd">        This shows that the there are 30 Tasks for Shots in the Sequence and the latest ``due_date``</span>
<span class="sd">        of any Task is ``2013-07-05``. Because the summary is grouped by ``entity``, we can also</span>
<span class="sd">        see the summaries for each Shot returned. Each Shot has 10 Tasks and the latest ``due_date``</span>
<span class="sd">        for each Shot. The difference between ``group_name`` and ``group_value`` is highlighted in</span>
<span class="sd">        this example as the name of the Shot is different from its value.</span>

<span class="sd">        **Example: Count all Tasks for a Sequence, find the latest due_date, group by Shot and</span>
<span class="sd">        Pipeline Step**</span>

<span class="sd">        &gt;&gt;&gt; sg.summarize(entity_type=&#39;Task&#39;,</span>
<span class="sd">        ...                 filters = [</span>
<span class="sd">        ...                    [&#39;entity.Shot.sg_sequence&#39;, &#39;is&#39;, {&#39;type&#39;: &#39;Sequence&#39;, &#39;id&#39;: 2}],</span>
<span class="sd">        ...                    [&#39;sg_status_list&#39;, &#39;is_not&#39;, &#39;na&#39;]],</span>
<span class="sd">        ...                 summary_fields=[{&#39;field&#39;: &#39;id&#39;, &#39;type&#39;: &#39;count&#39;},</span>
<span class="sd">        ...                                 {&#39;field&#39;: &#39;due_date&#39;, &#39;type&#39;: &#39;latest&#39;}],</span>
<span class="sd">        ...                 grouping=[{&#39;field&#39;: &#39;entity&#39;, &#39;type&#39;: &#39;exact&#39;, &#39;direction&#39;: &#39;asc&#39;},</span>
<span class="sd">        ...                           {&#39;field&#39;: &#39;step&#39;, &#39;type&#39;: &#39;exact&#39;, &#39;direction&#39;: &#39;asc&#39;}])</span>
<span class="sd">        {&#39;groups&#39;: [{&#39;group_name&#39;: &#39;shot_010&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 2, &#39;name&#39;: &#39;shot_010&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;groups&#39;: [{&#39;group_name&#39;: &#39;Client&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 1, &#39;name&#39;: &#39;Client&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-04&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Online&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 2, &#39;name&#39;: &#39;Online&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-05&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                ...</span>
<span class="sd">                                ... truncated for brevity</span>
<span class="sd">                                ...</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Comp&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 8, &#39;name&#39;: &#39;Comp&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-18&#39;, &#39;id&#39;: 1}}],</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-18&#39;, &#39;id&#39;: 10}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;shot_020&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 3, &#39;name&#39;: &#39;shot_020&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;groups&#39;: [{&#39;group_name&#39;: &#39;Client&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 1, &#39;name&#39;: &#39;Client&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-15&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Online&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 2, &#39;name&#39;: &#39;Online&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-16&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                ...</span>
<span class="sd">                                ... truncated for brevity</span>
<span class="sd">                                ...</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Comp&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 8, &#39;name&#39;: &#39;Comp&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-28&#39;, &#39;id&#39;: 1}}],</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-06-28&#39;, &#39;id&#39;: 10}},</span>
<span class="sd">                    {&#39;group_name&#39;: &#39;shot_030&#39;,</span>
<span class="sd">                     &#39;group_value&#39;: {&#39;id&#39;: 4, &#39;name&#39;: &#39;shot_030&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                     &#39;groups&#39;: [{&#39;group_name&#39;: &#39;Client&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 1, &#39;name&#39;: &#39;Client&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-20&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Online&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 2, &#39;name&#39;: &#39;Online&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-05-21&#39;, &#39;id&#39;: 1}},</span>
<span class="sd">                                ...</span>
<span class="sd">                                ... truncated for brevity</span>
<span class="sd">                                ...</span>
<span class="sd">                                {&#39;group_name&#39;: &#39;Comp&#39;,</span>
<span class="sd">                                 &#39;group_value&#39;: {&#39;id&#39;: 8, &#39;name&#39;: &#39;Comp&#39;, &#39;type&#39;: &#39;Step&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                                 &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 1}}],</span>
<span class="sd">                     &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 10}}],</span>
<span class="sd">        &#39;summaries&#39;: {&#39;due_date&#39;: &#39;2013-07-05&#39;, &#39;id&#39;: 30}}</span>

<span class="sd">        When grouping my more than one field, the grouping structure is repeated for each sub-group</span>
<span class="sd">        and summary values are returned for each group on each level.</span>

<span class="sd">        :param str entity_type: The entity type to summarize</span>
<span class="sd">        :param list filters: A list of conditions used to filter the find query. Uses the same</span>
<span class="sd">            syntax as :meth:`~shotgun_api3.Shotgun.find` method.</span>
<span class="sd">        :param list summary_fields: A list of dictionaries with the following keys:</span>

<span class="sd">            :field: The internal Shotgun field name you are summarizing.</span>
<span class="sd">            :type: The type of summary you are performing on the field. Summary types can be any of</span>
<span class="sd">                ``record_count``, ``count``, ``sum``, ``maximum``, ``minimum``, ``average``,</span>
<span class="sd">                ``earliest``, ``latest``, ``percentage``, ``status_percentage``, ``status_list``,</span>
<span class="sd">                ``checked``, ``unchecked`` depending on the type of field you&#39;re summarizing.</span>

<span class="sd">        :param str filter_operator: Operator to apply to the filters. Supported values are ``&quot;all&quot;``</span>
<span class="sd">            and ``&quot;any&quot;``. These are just another way of defining if the query is an AND or OR</span>
<span class="sd">            query. Defaults to ``&quot;all&quot;``.</span>
<span class="sd">        :param list grouping: Optional list of dicts with the following keys:</span>

<span class="sd">                :field: a string indicating the internal Shotgun field name on ``entity_type`` to</span>
<span class="sd">                    group results by.</span>
<span class="sd">                :type: A string indicating the type of grouping to perform for each group.</span>
<span class="sd">                    Valid types depend on the type of field you are grouping on and can be one of</span>
<span class="sd">                    ``exact``, ``tens``, ``hundreds``, ``thousands``, ``tensofthousands``,</span>
<span class="sd">                    ``hundredsofthousands``, ``millions``, ``day``, ``week``, ``month``,</span>
<span class="sd">                    ``quarter``,``year``, ``clustered_date``, ``oneday``, ``fivedays``,</span>
<span class="sd">                    ``entitytype``, ``firstletter``.</span>
<span class="sd">                :direction: A string that sets the order to display the grouped results. Valid</span>
<span class="sd">                    options are ``asc`` and  ``desc``. Defaults to ``asc``.</span>

<span class="sd">        :returns: dictionary containing grouping and summaries keys.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grouping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;summarize() &#39;grouping&#39; parameter must be a list or None&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_archived_projects</span><span class="p">:</span>
            <span class="c1"># This defaults to True on the server (no argument is sent)</span>
            <span class="c1"># So we only need to check the server version if it is False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_include_archived_projects</span><span class="p">()</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                  <span class="s2">&quot;summaries&quot;</span><span class="p">:</span> <span class="n">summary_fields</span><span class="p">,</span>
                  <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">include_archived_projects</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Defaults to True on the server, so only pass it if it&#39;s False</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;include_archived_projects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">grouping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;grouping&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>

        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;summarize&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">records</span></div>

<div class="viewcode-block" id="Shotgun.create"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">return_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new entity of the specified ``entity_type``.</span>

<span class="sd">            &gt;&gt;&gt; data = {</span>
<span class="sd">            ...     &quot;project&quot;: {&quot;type&quot;: &quot;Project&quot;, &quot;id&quot;: 161},</span>
<span class="sd">            ...     &quot;sg_sequence&quot;: {&quot;type&quot;: &quot;Sequence&quot;, &quot;id&quot;: 109},</span>
<span class="sd">            ...     &quot;code&quot;: &quot;001_100&quot;,</span>
<span class="sd">            ...     &#39;sg_status_list&#39;: &quot;ip&quot;</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; sg.create(&#39;Shot&#39;, data)</span>
<span class="sd">            {&#39;code&#39;: &#39;001_100&#39;,</span>
<span class="sd">             &#39;id&#39;: 2557,</span>
<span class="sd">             &#39;project&#39;: {&#39;id&#39;: 161, &#39;name&#39;: &#39;Pied Piper&#39;, &#39;type&#39;: &#39;Project&#39;},</span>
<span class="sd">             &#39;sg_sequence&#39;: {&#39;id&#39;: 109, &#39;name&#39;: &#39;Sequence 001&#39;, &#39;type&#39;: &#39;Sequence&#39;},</span>
<span class="sd">             &#39;sg_status_list&#39;: &#39;ip&#39;,</span>
<span class="sd">             &#39;type&#39;: &#39;Shot&#39;}</span>

<span class="sd">        :param str entity_type: Shotgun entity type to create.</span>
<span class="sd">        :param dict data: Dictionary of fields and corresponding values to set on the new entity. If</span>
<span class="sd">            ``image`` or ``filmstrip_image`` fields are provided, the file path will be uploaded</span>
<span class="sd">            to the server automatically.</span>
<span class="sd">        :param list return_fields: Optional list of additional field values to return from the new</span>
<span class="sd">            entity. Defaults to ``id`` field.</span>

<span class="sd">            .. seealso:: :ref:`combining-related-queries`</span>

<span class="sd">        :returns: Shotgun entity dictionary containing the field/value pairs of all of the fields</span>
<span class="sd">            set from the ``data`` parameter as well as the defaults ``type`` and ``id``. If any</span>
<span class="sd">            additional fields were provided using the ``return_fields`` parameter, these would be</span>
<span class="sd">            included as well.</span>

<span class="sd">            .. seealso:: :ref:`entity-fields`</span>

<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_fields</span><span class="p">:</span>
            <span class="n">return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">upload_image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">upload_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;filmstrip_image&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>
                                   <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s2">&quot;return_fields&quot;</span><span class="p">:</span> <span class="n">return_fields</span>
        <span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">upload_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">upload_image</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)]],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_filmstrip_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">upload_filmstrip_image</span><span class="p">)</span>
            <span class="n">filmstrip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)]],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filmstrip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Shotgun.update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">multi_entity_update_modes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the specified entity with the supplied data.</span>

<span class="sd">        &gt;&gt;&gt; shots = [</span>
<span class="sd">        ...    {&#39;type&#39;:&#39;Shot&#39;, &#39;id&#39;:&#39;40435&#39;},</span>
<span class="sd">        ...    {&#39;type&#39;:&#39;Shot&#39;, &#39;id&#39;:&#39;40438&#39;},</span>
<span class="sd">        ...    {&#39;type&#39;:&#39;Shot&#39;, &#39;id&#39;:&#39;40441&#39;}]</span>
<span class="sd">        &gt;&gt;&gt; data = {</span>
<span class="sd">        ...    &#39;shots&#39;: shots_asset_is_in,</span>
<span class="sd">        ...    &#39;sg_status_list&#39;:&#39;rev&#39;}</span>
<span class="sd">        &gt;&gt;&gt; sg.update(&quot;Asset&quot;, 55, data)</span>
<span class="sd">        {&#39;type&#39;: &#39;Shot&#39;,</span>
<span class="sd">         &#39;id&#39;: 55,</span>
<span class="sd">         &#39;sg_status_`list`&#39;: &#39;rev&#39;,</span>
<span class="sd">         &#39;shots&#39;: [{&#39;id&#39;: 40435, &#39;name&#39;: &#39;100_010&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                   {&#39;id&#39;: 40438, &#39;name&#39;: &#39;100_040&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">                   {&#39;id&#39;: 40441, &#39;name&#39;: &#39;100_070&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;valid&#39;: &#39;valid&#39;}]</span>
<span class="sd">        }</span>

<span class="sd">        :param str entity_type: Entity type to update.</span>
<span class="sd">        :param id entity_id: id of the entity to update.</span>
<span class="sd">        :param dict data: key/value pairs where key is the field name and value is the value to set</span>
<span class="sd">            for that field. This method does not restrict the updating of fields hidden in the web</span>
<span class="sd">            UI via the Project Tracking Settings panel.</span>
<span class="sd">        :param dict multi_entity_update_modes: Optional dict indicating what update mode to use</span>
<span class="sd">            when updating a multi-entity link field. The keys in the dict are the fields to set</span>
<span class="sd">            the mode for, and the values from the dict are one of ``set``, ``add``, or ``remove``.</span>
<span class="sd">            Defaults to ``set``.</span>
<span class="sd">            ::</span>

<span class="sd">                multi_entity_update_modes={&quot;shots&quot;: &quot;add&quot;, &quot;assets&quot;: &quot;remove&quot;}</span>

<span class="sd">        :returns: Dictionary of the fields updated, with the default keys `type` and `id` added as well.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">upload_image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upload_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
        <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;filmstrip_image&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>
                                   <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">upload_filmstrip_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
                <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">extra_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_extra_data</span><span class="p">(</span>
                        <span class="n">multi_entity_update_modes</span><span class="p">,</span> <span class="s2">&quot;multi_entity_update_mode&quot;</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">upload_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">upload_image</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)]],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upload_filmstrip_image</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">upload_filmstrip_image</span><span class="p">)</span>
            <span class="n">filmstrip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)]],</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filmstrip</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filmstrip_image&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Shotgun.delete"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retire the specified entity.</span>

<span class="sd">        Entities in Shotgun are not &quot;deleted&quot; destructively, they are instead, &quot;retired&quot;. This</span>
<span class="sd">        means they are placed in the trash where they are no longer accessible to users.</span>

<span class="sd">        The entity can be brought back to life using :meth:`~shotgun_api3.Shotgun.revive`.</span>

<span class="sd">            &gt;&gt;&gt; sg.delete(&quot;Shot&quot;, 2557)</span>
<span class="sd">            True</span>

<span class="sd">        :param str entity_type: Shotgun entity type to delete.</span>
<span class="sd">        :param id entity_id: ``id`` of the entity to delete.</span>
<span class="sd">        :returns: ``True`` if the entity was deleted, ``False`` otherwise (for example, if the</span>
<span class="sd">            entity was already deleted).</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        :raises: :class:`Fault` if entity does not exist (deleted or not).</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.revive"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.revive">[docs]</a>    <span class="k">def</span> <span class="nf">revive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revive an entity that has previously been deleted.</span>

<span class="sd">        &gt;&gt;&gt; sg.revive(&quot;Shot&quot;, 860)</span>
<span class="sd">        True</span>

<span class="sd">        :param str entity_type: Shotgun entity type to revive.</span>
<span class="sd">        :param int entity_id: id of the entity to revive.</span>
<span class="sd">        :returns: ``True`` if the entity was revived, ``False`` otherwise (e.g. if the</span>
<span class="sd">            entity is not currently retired).</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;revive&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.batch"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.batch">[docs]</a>    <span class="k">def</span> <span class="nf">batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a batch request of several :meth:`~shotgun_api3.Shotgun.create`,</span>
<span class="sd">        :meth:`~shotgun_api3.Shotgun.update`, and :meth:`~shotgun_api3.Shotgun.delete` calls.</span>

<span class="sd">        All requests are performed within a transaction, so either all will complete or none will.</span>

<span class="sd">        Ex. Make a bunch of shots::</span>

<span class="sd">            batch_data = []</span>
<span class="sd">            for i in range(1,100):</span>
<span class="sd">                data = {</span>
<span class="sd">                    &quot;code&quot;: &quot;shot_%04d&quot; % i,</span>
<span class="sd">                    &quot;project&quot;: project</span>
<span class="sd">                }</span>
<span class="sd">                batch_data.append({&quot;request_type&quot;: &quot;create&quot;, &quot;entity_type&quot;: &quot;Shot&quot;, &quot;data&quot;: data})</span>
<span class="sd">            sg.batch(batch_data)</span>

<span class="sd">        Example output::</span>

<span class="sd">             [{&#39;code&#39;: &#39;shot_0001&#39;,</span>
<span class="sd">               &#39;type&#39;: &#39;Shot&#39;,</span>
<span class="sd">               &#39;id&#39;: 3624,</span>
<span class="sd">               &#39;project&#39;: {&#39;id&#39;: 4, &#39;name&#39;: &#39;Demo Project&#39;, &#39;type&#39;: &#39;Project&#39;}},</span>
<span class="sd">              ...</span>
<span class="sd">              ... and a bunch more ...</span>
<span class="sd">              ...</span>
<span class="sd">              {&#39;code&#39;: &#39;shot_0099&#39;,</span>
<span class="sd">               &#39;type&#39;: &#39;Shot&#39;,</span>
<span class="sd">               &#39;id&#39;: 3722,</span>
<span class="sd">               &#39;project&#39;: {&#39;id&#39;: 4, &#39;name&#39;: &#39;Demo Project&#39;, &#39;type&#39;: &#39;Project&#39;}}]</span>

<span class="sd">        Ex. All three types of requests in one batch::</span>

<span class="sd">            batch_data = [</span>
<span class="sd">              {&quot;request_type&quot;: &quot;create&quot;, &quot;entity_type&quot;: &quot;Shot&quot;, &quot;data&quot;: {&quot;code&quot;: &quot;New Shot 1&quot;, &quot;project&quot;: project}},</span>
<span class="sd">              {&quot;request_type&quot;: &quot;update&quot;, &quot;entity_type&quot;: &quot;Shot&quot;, &quot;entity_id&quot;: 3624, &quot;data&quot;: {&quot;code&quot;: &quot;Changed 1&quot;}},</span>
<span class="sd">              {&quot;request_type&quot;: &quot;delete&quot;, &quot;entity_type&quot;: &quot;Shot&quot;, &quot;entity_id&quot;: 3624}</span>
<span class="sd">            ]</span>
<span class="sd">            sg.batch(batch_data)</span>

<span class="sd">        Example output::</span>

<span class="sd">             [{&#39;code&#39;: &#39;New Shot 1&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;id&#39;: 3723,</span>
<span class="sd">               &#39;project&#39;: {&#39;id&#39;: 4, &#39;name&#39;: &#39;Demo Project&#39;, &#39;type&#39;: &#39;Project&#39;}},</span>
<span class="sd">              {&#39;code&#39;: &#39;Changed 1&#39;, &#39;type&#39;: &#39;Shot&#39;, &#39;id&#39;: 3624},</span>
<span class="sd">              True]</span>

<span class="sd">        :param list requests: A list of dict&#39;s of the form which have a request_type key and also</span>
<span class="sd">            specifies:</span>

<span class="sd">            - create: ``entity_type``, data dict of fields to set</span>
<span class="sd">            - update: ``entity_type``, ``entity_id``, data dict of fields to set,</span>
<span class="sd">                      and optionally ``multi_entity_update_modes``</span>
<span class="sd">            - delete: ``entity_type`` and entity_id</span>
<span class="sd">        :returns: A list of values for each operation. Create and update requests return a dict of</span>
<span class="sd">            the fields updated. Delete requests return ``True`` if the entity was deleted.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requests</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;batch() expects a list.  Instead was sent a </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>

        <span class="c1"># If we have no requests, just return an empty list immediately.</span>
        <span class="c1"># Nothing to process means nothing to get results of.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">calls</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">_required_keys</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">required_keys</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_keys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> missing required key: </span><span class="si">%s</span><span class="s2">. &quot;</span>
                                   <span class="s2">&quot;Value was: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">),</span> <span class="n">data</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
            <span class="n">_required_keys</span><span class="p">(</span><span class="s2">&quot;Batched request&quot;</span><span class="p">,</span>
                           <span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">,</span> <span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                           <span class="n">req</span><span class="p">)</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;request_type&quot;</span><span class="p">:</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">],</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]}</span>

            <span class="k">if</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;create&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s2">&quot;Batched create request&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;return_fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;return_fields&quot;</span><span class="p">)</span> <span class="ow">or</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;update&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s2">&quot;Batched update request&quot;</span><span class="p">,</span>
                               <span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">],</span>
                               <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">]</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span>
                    <span class="n">req</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
                    <span class="n">extra_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_extra_data</span><span class="p">(</span>
                        <span class="n">req</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;multi_entity_update_modes&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;multi_entity_update_mode&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;multi_entity_update_mode&quot;</span> <span class="ow">in</span> <span class="n">req</span><span class="p">:</span>
                    <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;multi_entity_update_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;multi_entity_update_mode&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;delete&quot;</span><span class="p">:</span>
                <span class="n">_required_keys</span><span class="p">(</span><span class="s2">&quot;Batched delete request&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">],</span> <span class="n">req</span><span class="p">)</span>
                <span class="n">request_params</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Invalid request_type &#39;</span><span class="si">%s</span><span class="s2">&#39; for batch&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                   <span class="n">req</span><span class="p">[</span><span class="s2">&quot;request_type&quot;</span><span class="p">]))</span>
            <span class="n">calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_params</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span> <span class="n">calls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.work_schedule_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.work_schedule_read">[docs]</a>    <span class="k">def</span> <span class="nf">work_schedule_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the work day rules for a given date range.</span>

<span class="sd">        .. versionadded:: 3.0.9</span>
<span class="sd">            Requires Shotgun server v3.2.0+</span>

<span class="sd">        This returns the defined WorkDayRules between the ``start_date`` and ``end_date`` inclusive</span>
<span class="sd">        as a dict where the key is the date and the value is another dict describing the rule for</span>
<span class="sd">        that date.</span>

<span class="sd">        Rules are represented by a dict with the following keys:</span>

<span class="sd">        :description: the description entered into the work day rule exception if applicable.</span>
<span class="sd">        :reason: one of six options:</span>

<span class="sd">            - STUDIO_WORK_WEEK: standard studio schedule applies</span>
<span class="sd">            - STUDIO_EXCEPTION: studio-wide exception applies</span>
<span class="sd">            - PROJECT_WORK_WEEK: standard project schedule applies</span>
<span class="sd">            - PROJECT_EXCEPTION: project-specific exception applies</span>
<span class="sd">            - USER_WORK_WEEK: standard user work week applies</span>
<span class="sd">            - USER_EXCEPTION: user-specific exception applies</span>

<span class="sd">        :working: boolean indicating whether it is a &quot;working&quot; day or not.</span>

<span class="sd">        &gt;&gt;&gt; sg.work_schedule_read(&quot;2015-12-21&quot;, &quot;2015-12-25&quot;)</span>
<span class="sd">        {&#39;2015-12-21&#39;: {&#39;description&#39;: None,</span>
<span class="sd">                        &#39;reason&#39;: &#39;STUDIO_WORK_WEEK&#39;,</span>
<span class="sd">                        &#39;working&#39;: True},</span>
<span class="sd">         &#39;2015-12-22&#39;: {&#39;description&#39;: None,</span>
<span class="sd">                        &#39;reason&#39;: &#39;STUDIO_WORK_WEEK&#39;,</span>
<span class="sd">                        &#39;working&#39;: True},</span>
<span class="sd">         &#39;2015-12-23&#39;: {&#39;description&#39;: None,</span>
<span class="sd">                        &#39;reason&#39;: &#39;STUDIO_WORK_WEEK&#39;,</span>
<span class="sd">                        &#39;working&#39;: True},</span>
<span class="sd">         &#39;2015-12-24&#39;: {&#39;description&#39;: &#39;Closed for Christmas Eve&#39;,</span>
<span class="sd">                        &#39;reason&#39;: &#39;STUDIO_EXCEPTION&#39;,</span>
<span class="sd">                        &#39;working&#39;: False},</span>
<span class="sd">         &#39;2015-12-25&#39;: {&#39;description&#39;: &#39;Closed for Christmas&#39;,</span>
<span class="sd">                        &#39;reason&#39;: &#39;STUDIO_EXCEPTION&#39;,</span>
<span class="sd">                        &#39;working&#39;: False}}</span>


<span class="sd">        :param str start_date: Start date of date range. ``YYYY-MM-DD``</span>
<span class="sd">        :param str end_date: End date of date range. ``YYYY-MM-DD``</span>
<span class="sd">        :param dict project: Optional Project entity to query `WorkDayRules` for.</span>
<span class="sd">        :param dict user: Optional HumanUser entity to query WorkDayRules for.</span>
<span class="sd">        :returns: Complex dict containing each date and the WorkDayRule defined for that date</span>
<span class="sd">            between the ``start_date`` and ``end date`` inclusive. See above for details.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Work schedule support requires server version 3.2 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;The start_date and end_date arguments must be strings in YYYY-MM-DD format&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;work_schedule_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.work_schedule_update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.work_schedule_update">[docs]</a>    <span class="k">def</span> <span class="nf">work_schedule_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">working</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">recalculate_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the work schedule for a given date.</span>

<span class="sd">        .. versionadded:: 3.0.9</span>
<span class="sd">            Requires Shotgun server v3.2.0+</span>

<span class="sd">        If neither ``project`` nor ``user`` are passed in, the studio work schedule will be updated.</span>
<span class="sd">        ``project`` and ``user`` can only be used exclusively of each other.</span>

<span class="sd">        &gt;&gt;&gt; sg.work_schedule_update (&quot;2015-12-31&quot;, working=False,</span>
<span class="sd">        ...                          description=&quot;Studio closed for New Years Eve&quot;, project=None,</span>
<span class="sd">        ...                          user=None, recalculate_field=None)</span>
<span class="sd">        {&#39;date&#39;: &#39;2015-12-31&#39;,</span>
<span class="sd">         &#39;description&#39;: &quot;Studio closed for New Years Eve&quot;,</span>
<span class="sd">         &#39;project&#39;: None,</span>
<span class="sd">         &#39;user&#39;: None,</span>
<span class="sd">         &#39;working&#39;: False}</span>

<span class="sd">        :param str date: Date of WorkDayRule to update. ``YYY-MM-DD``</span>
<span class="sd">        :param bool working: Indicates whether the day is a working day or not.</span>
<span class="sd">        :param str description: Optional reason for time off.</span>
<span class="sd">        :param dict project: Optional Project entity to assign the rule to. Cannot be used with the</span>
<span class="sd">            ``user`` param.</span>
<span class="sd">        :param dict user: Optional HumanUser entity to assign the rule to. Cannot be used with the</span>
<span class="sd">            ``project`` param.</span>
<span class="sd">        :param str recalculate_field: Optional schedule field that will be recalculated on Tasks</span>
<span class="sd">            when they are affected by a change in working schedule. Options are ``due_date`` or</span>
<span class="sd">            ``duration``. Defaults to the value set in the Shotgun web application&#39;s Site</span>
<span class="sd">            Preferences.</span>
<span class="sd">        :returns: dict containing key/value pairs for each value of the work day rule updated.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Work schedule support requires server version 3.2 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;The date argument must be string in YYYY-MM-DD format&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">working</span><span class="o">=</span><span class="n">working</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">recalculate_field</span><span class="o">=</span><span class="n">recalculate_field</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;work_schedule_update&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.follow"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.follow">[docs]</a>    <span class="k">def</span> <span class="nf">follow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the entity to the user&#39;s followed entities.</span>

<span class="sd">        If the user is already following the entity, the method will succeed but nothing will be</span>
<span class="sd">        changed on the server-side.</span>

<span class="sd">            &gt;&gt;&gt; sg.follow({&quot;type&quot;: &quot;HumanUser&quot;, &quot;id&quot;: 42}, {&quot;type&quot;: &quot;Shot&quot;, &quot;id&quot;: 2050})</span>
<span class="sd">            {&#39;followed&#39;: True, &#39;user&#39;: {&#39;type&#39;: &#39;HumanUser&#39;, &#39;id&#39;: 42},</span>
<span class="sd">             &#39;entity&#39;: {&#39;type&#39;: &#39;Shot&#39;, &#39;id&#39;: 2050}}</span>

<span class="sd">        :param dict user: User entity that will follow the entity.</span>
<span class="sd">        :param dict entity: Shotgun entity to be followed.</span>
<span class="sd">        :returns: dict with ``&quot;followed&quot;: True`` as well as key/values for the params that were</span>
<span class="sd">            passed in.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Follow support requires server version 5.2 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;follow&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.unfollow"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.unfollow">[docs]</a>    <span class="k">def</span> <span class="nf">unfollow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove entity from the user&#39;s followed entities.</span>

<span class="sd">        This does nothing if the user is not following the entity.</span>

<span class="sd">        &gt;&gt;&gt; sg.unfollow({&quot;type&quot;: &quot;HumanUser&quot;, &quot;id&quot;: 42}, {&quot;type&quot;: &quot;Shot&quot;, &quot;id&quot;: 2050})</span>
<span class="sd">        {&#39;entity&#39;: {&#39;type&#39;: &#39;Shot&#39;, &#39;id&#39;: 2050}, &#39;user&#39;: {&#39;type&#39;: &#39;HumanUser&#39;, &#39;id&#39;: 42},</span>
<span class="sd">         &#39;unfollowed&#39;: True}</span>

<span class="sd">        :param dict user: User entity that will unfollow the entity.</span>
<span class="sd">        :param dict entity: Entity to be unfollowed</span>
<span class="sd">        :returns: dict with ``&quot;unfollowed&quot;: True`` as well as key/values for the params that were</span>
<span class="sd">            passed in.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Follow support requires server version 5.2 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;unfollow&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.followers"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.followers">[docs]</a>    <span class="k">def</span> <span class="nf">followers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all followers for an entity.</span>

<span class="sd">            &gt;&gt;&gt; sg.followers({&quot;type&quot;: &quot;Shot&quot;, &quot;id&quot;: 2050})</span>
<span class="sd">            [{&#39;status&#39;: &#39;act&#39;, &#39;valid&#39;: &#39;valid&#39;, &#39;type&#39;: &#39;HumanUser&#39;, &#39;name&#39;: &#39;Richard Hendriks&#39;,</span>
<span class="sd">              &#39;id&#39;: 42},</span>
<span class="sd">             {&#39;status&#39;: &#39;act&#39;, &#39;valid&#39;: &#39;valid&#39;, &#39;type&#39;: &#39;HumanUser&#39;, &#39;name&#39;: &#39;Bertram Gilfoyle&#39;,</span>
<span class="sd">              &#39;id&#39;: 33},</span>
<span class="sd">             {&#39;status&#39;: &#39;act&#39;, &#39;valid&#39;: &#39;valid&#39;, &#39;type&#39;: &#39;HumanUser&#39;, &#39;name&#39;: &#39;Dinesh Chugtai&#39;,</span>
<span class="sd">              &#39;id&#39;: 57}]</span>

<span class="sd">        :param dict entity: Entity to find followers of.</span>
<span class="sd">        :returns: list of dicts representing each user following the entity</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        :versionadded:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Follow support requires server version 5.2 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">entity</span><span class="o">=</span><span class="n">entity</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;followers&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.following"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.following">[docs]</a>    <span class="k">def</span> <span class="nf">following</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all entity instances a user is following.</span>

<span class="sd">        Optionally, a project and/or entity_type can be supplied to restrict returned results.</span>

<span class="sd">            &gt;&gt;&gt; user = {&quot;type&quot;: &quot;HumanUser&quot;, &quot;id&quot;: 1234}</span>
<span class="sd">            &gt;&gt;&gt; project = {&quot;type&quot;: &quot;Project&quot;, &quot;id&quot;: 1234}</span>
<span class="sd">            &gt;&gt;&gt; entity_type = &quot;Task&quot;</span>
<span class="sd">            &gt;&gt;&gt; sg.following(user, project=project, entity_type=entity_type)</span>
<span class="sd">            [{&quot;type&quot;:&quot;Task&quot;, &quot;id&quot;:1},</span>
<span class="sd">             {&quot;type&quot;:&quot;Task&quot;, &quot;id&quot;:2},</span>
<span class="sd">             {&quot;type&quot;:&quot;Task&quot;, &quot;id&quot;:3}]</span>

<span class="sd">        :param dict user: Find what this person is following.</span>
<span class="sd">        :param dict project: Optional filter to only return results from a specific project.</span>
<span class="sd">        :param str entity_type: Optional filter to only return results from one entity type.</span>
<span class="sd">        :returns: list of dictionaries, each containing entity type &amp; id&#39;s being followed.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">ensure_user_following_support</span><span class="p">()</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project</span>
        <span class="k">if</span> <span class="n">entity_type</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_type</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;following&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_entity_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_entity_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_entity_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all active entity types, their display names, and their visibility.</span>

<span class="sd">        If the project parameter is specified, the schema visibility for the given project is</span>
<span class="sd">        being returned. If the project parameter is omitted or set to ``None``, a full listing is</span>
<span class="sd">        returned where per-project entity type visibility settings are not considered.</span>

<span class="sd">        &gt;&gt;&gt; sg.schema_entity_read()</span>
<span class="sd">        {&#39;ActionMenuItem&#39;: {&#39;name&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;Action Menu Item&#39;},</span>
<span class="sd">                            &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">         &#39;ApiUser&#39;: {&#39;name&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;Script&#39;},</span>
<span class="sd">                     &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">         &#39;AppWelcomeUserConnection&#39;: {&#39;name&#39;: {&#39;editable&#39;: False,</span>
<span class="sd">                                               &#39;value&#39;: &#39;App Welcome User Connection&#39;},</span>
<span class="sd">                                      &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">         &#39;Asset&#39;: {&#39;name&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;Asset&#39;},</span>
<span class="sd">                   &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">         &#39;AssetAssetConnection&#39;: {&#39;name&#39;: {&#39;editable&#39;: False,</span>
<span class="sd">                                           &#39;value&#39;: &#39;Asset Asset Connection&#39;},</span>
<span class="sd">                                  &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">         &#39;...&#39;</span>
<span class="sd">        }</span>

<span class="sd">        :param dict project_entity: Optional Project entity specifying which project to return</span>
<span class="sd">            the listing for. If omitted or set to ``None``, per-project visibility settings are</span>
<span class="sd">            not taken into consideration and the global list is returned. Example:</span>
<span class="sd">            ``{&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: 3}``</span>
<span class="sd">        :returns: dict of Entity Type to dict containing the display name.</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        .. note::</span>
<span class="sd">            The returned display names for this method will be localized when the ``localize`` Shotgun config property is set to ``True``. See :ref:`localization` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_entity_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_entity_read&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the schema for all fields on all entities.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If ``project_entity`` is not specified, everything is reported as visible.</span>

<span class="sd">        &gt;&gt;&gt; sg.schema_read()</span>
<span class="sd">        {&#39;ActionMenuItem&#39;: {&#39;created_at&#39;: {&#39;data_type&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;date_time&#39;},</span>
<span class="sd">                                           &#39;description&#39;: {&#39;editable&#39;: True,  &#39;value&#39;: &#39;&#39;},</span>
<span class="sd">                                           &#39;editable&#39;: {&#39;editable&#39;: False, &#39;value&#39;: False},</span>
<span class="sd">                                           &#39;entity_type&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;ActionMenuItem&#39;},</span>
<span class="sd">                                           &#39;mandatory&#39;: {&#39;editable&#39;: False, &#39;value&#39;: False},</span>
<span class="sd">                                           &#39;name&#39;: {&#39;editable&#39;: True, &#39;value&#39;: &#39;Date Created&#39;},</span>
<span class="sd">                                           &#39;properties&#39;: {&#39;default_value&#39;: {&#39;editable&#39;: False, &#39;value&#39;: None},</span>
<span class="sd">                                                          &#39;summary_default&#39;: {&#39;editable&#39;: True, &#39;value&#39;: &#39;none&#39;}},</span>
<span class="sd">                                           &#39;unique&#39;: {&#39;editable&#39;: False, &#39;value&#39;: False},</span>
<span class="sd">                                           &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}},</span>
<span class="sd">                            &#39;created_by&#39;: {&#39;data_type&#39;: {&#39;editable&#39;: False,&#39;value&#39;: &#39;entity&#39;},</span>
<span class="sd">                                           &#39;description&#39;: {&#39;editable&#39;: True,&#39;value&#39;: &#39;&#39;},</span>
<span class="sd">                                           &#39;editable&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                           &#39;entity_type&#39;: {&#39;editable&#39;: False,&#39;value&#39;: &#39;ActionMenuItem&#39;},</span>
<span class="sd">                                           &#39;mandatory&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                           &#39;name&#39;: {&#39;editable&#39;: True,&#39;value&#39;: &#39;Created by&#39;},</span>
<span class="sd">                                           &#39;properties&#39;: {&#39;default_value&#39;: {&#39;editable&#39;: False,&#39;value&#39;: None},</span>
<span class="sd">                                                          &#39;summary_default&#39;: {&#39;editable&#39;: True,&#39;value&#39;: &#39;none&#39;},</span>
<span class="sd">                                                          &#39;valid_types&#39;: {&#39;editable&#39;: True,&#39;value&#39;:</span>
<span class="sd">                                                                          [&#39;HumanUser&#39;,&#39;ApiUser&#39;]}},</span>
<span class="sd">                                           &#39;unique&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                           &#39;visible&#39;: {&#39;editable&#39;: False,&#39;value&#39;: True}},</span>
<span class="sd">                            ...</span>
<span class="sd">                            ...</span>
<span class="sd">         ...</span>
<span class="sd">         ...</span>
<span class="sd">         &#39;Version&#39;: {&#39;client_approved&#39;: {&#39;data_type&#39;: {&#39;editable&#39;: False,&#39;value&#39;: &#39;checkbox&#39;},</span>
<span class="sd">                                         &#39;description&#39;: {&#39;editable&#39;: True,&#39;value&#39;: &#39;&#39;},</span>
<span class="sd">                                         &#39;editable&#39;: {&#39;editable&#39;: False,&#39;value&#39;: True},</span>
<span class="sd">                                         &#39;entity_type&#39;: {&#39;editable&#39;: False,&#39;value&#39;: &#39;Version&#39;},</span>
<span class="sd">                                         &#39;mandatory&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                         &#39;name&#39;: {&#39;editable&#39;: True,&#39;value&#39;: &#39;Client Approved&#39;},</span>
<span class="sd">                                         &#39;properties&#39;: {&#39;default_value&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                                        &#39;summary_default&#39;: {&#39;editable&#39;: False,&#39;value&#39;: &#39;none&#39;}},</span>
<span class="sd">                                         &#39;unique&#39;: {&#39;editable&#39;: False,&#39;value&#39;: False},</span>
<span class="sd">                                         &#39;visible&#39;: {&#39;editable&#39;: False,&#39;value&#39;: True}},</span>
<span class="sd">                     ...</span>
<span class="sd">                     ...</span>
<span class="sd">         ...</span>
<span class="sd">         ...</span>
<span class="sd">        }</span>

<span class="sd">        :param dict project_entity: Optional, Project entity specifying which project to return</span>
<span class="sd">            the listing for. If omitted or set to ``None``, per-project visibility settings are</span>
<span class="sd">            not taken into consideration and the global list is returned. Example:</span>
<span class="sd">            ``{&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: 3}``. Defaults to ``None``.</span>
<span class="sd">        :returns: A nested dict object containing a key/value pair for all fields of all entity</span>
<span class="sd">            types. Properties that are ``&#39;editable&#39;: True``, can be updated using the</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.schema_field_update` method.</span>
<span class="sd">        :rtype: dict</span>

<span class="sd">        .. note::</span>
<span class="sd">            The returned display names for this method will be localized when the ``localize`` Shotgun config property is set to ``True``. See :ref:`localization` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_read&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_field_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_read">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get schema for all fields on the specified entity type or just the field name specified</span>
<span class="sd">        if provided.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Unlike how the results of a :meth:`~shotgun_api3.Shotgun.find` can be pumped into a</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.create` or :meth:`~shotgun_api3.Shotgun.update`, the</span>
<span class="sd">            results of :meth:`~shotgun_api3.Shotgun.schema_field_read` are not compatible with</span>
<span class="sd">            the format used for :meth:`~shotgun_api3.Shotgun.schema_field_create` or</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.schema_field_update`. If you need to pipe the results</span>
<span class="sd">            from :meth:`~shotgun_api3.Shotgun.schema_field_read` into a</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.schema_field_create` or</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.schema_field_update`, you will need to reformat the</span>
<span class="sd">            data in your script.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If you don&#39;t specify a ``project_entity``, everything is reported as visible.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The returned display names for this method will be localized when the ``localize`` Shotgun config property is set to ``True``. See :ref:`localization` for more information.</span>

<span class="sd">        &gt;&gt;&gt; sg.schema_field_read(&#39;Asset&#39;, &#39;shots&#39;)</span>
<span class="sd">        {&#39;shots&#39;: {&#39;data_type&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;multi_entity&#39;},</span>
<span class="sd">                   &#39;description&#39;: {&#39;editable&#39;: True, &#39;value&#39;: &#39;&#39;},</span>
<span class="sd">                   &#39;editable&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True},</span>
<span class="sd">                   &#39;entity_type&#39;: {&#39;editable&#39;: False, &#39;value&#39;: &#39;Asset&#39;},</span>
<span class="sd">                   &#39;mandatory&#39;: {&#39;editable&#39;: False, &#39;value&#39;: False},</span>
<span class="sd">                   &#39;name&#39;: {&#39;editable&#39;: True, &#39;value&#39;: &#39;Shots&#39;},</span>
<span class="sd">                   &#39;properties&#39;: {&#39;default_value&#39;: {&#39;editable&#39;: False,</span>
<span class="sd">                                                    &#39;value&#39;: None},</span>
<span class="sd">                                  &#39;summary_default&#39;: {&#39;editable&#39;: True,</span>
<span class="sd">                                                      &#39;value&#39;: &#39;none&#39;},</span>
<span class="sd">                                  &#39;valid_types&#39;: {&#39;editable&#39;: True,</span>
<span class="sd">                                                  &#39;value&#39;: [&#39;Shot&#39;]}},</span>
<span class="sd">                   &#39;unique&#39;: {&#39;editable&#39;: False, &#39;value&#39;: False},</span>
<span class="sd">                   &#39;visible&#39;: {&#39;editable&#39;: False, &#39;value&#39;: True}}}</span>

<span class="sd">        :param str entity_type: Entity type to get the schema for.</span>
<span class="sd">        :param str field_name: Optional internal Shotgun name of the field to get the schema</span>
<span class="sd">            definition for. If this parameter is excluded or set to ``None``, data structures of</span>
<span class="sd">            all fields will be returned. Defaults to ``None``. Example: ``sg_temp_field``.</span>
<span class="sd">        :param dict project_entity: Optional Project entity specifying which project to return</span>
<span class="sd">            the listing for. If omitted or set to ``None``, per-project visibility settings are</span>
<span class="sd">            not taken into consideration and the global list is returned. Example:</span>
<span class="sd">            ``{&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: 3}``</span>
<span class="sd">        :returns: a nested dict object containing a key/value pair for the ``field_name`` specified</span>
<span class="sd">            and its properties, or if no field_name is specified, for all the fields of the</span>
<span class="sd">            ``entity_type``. Properties that are ``&#39;editable&#39;: True``, can be updated using the</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.schema_field_update` method.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">field_name</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_field_read&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_field_create"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_create">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a field for the specified entity type.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If the internal Shotgun field name computed from the provided ``display_name`` already</span>
<span class="sd">            exists, the internal Shotgun field name will automatically be appended with ``_1`` in</span>
<span class="sd">            order to create a unique name. The integer suffix will be incremented by 1 until a</span>
<span class="sd">            unique name is found.</span>

<span class="sd">        &gt;&gt;&gt; properties = {&quot;summary_default&quot;: &quot;count&quot;, &quot;description&quot;: &quot;Complexity breakdown of Asset&quot;}</span>
<span class="sd">        &gt;&gt;&gt; sg.schema_field_create(&quot;Asset&quot;, &quot;text&quot;, &quot;Complexity&quot;, properties)</span>
<span class="sd">        &#39;sg_complexity&#39;</span>

<span class="sd">        :param str entity_type: Entity type to add the field to.</span>
<span class="sd">        :param str data_type: Shotgun data type for the new field.</span>
<span class="sd">        :param str display_name: Specifies the display name of the field you are creating. The</span>
<span class="sd">            system name will be created from this display name and returned upon successful</span>
<span class="sd">            creation.</span>
<span class="sd">        :param dict properties: Dict of valid properties for the new field. Use this to specify</span>
<span class="sd">            other field properties such as the &#39;description&#39; or &#39;summary_default&#39;.</span>
<span class="sd">        :returns: The internal Shotgun name for the new field, this is different to the</span>
<span class="sd">            ``display_name`` parameter passed in.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;property_name&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_list</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s2">&quot;property_name&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_field_create&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_field_update"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_update">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">project_entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the properties for the specified field on an entity.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Although the property name may be the key in a nested dictionary, like</span>
<span class="sd">            &#39;summary_default&#39;, it is treated no differently than keys that are up</span>
<span class="sd">            one level, like &#39;description&#39;.</span>

<span class="sd">        &gt;&gt;&gt; properties = {&quot;name&quot;: &quot;Test Number Field Renamed&quot;, &quot;summary_default&quot;: &quot;sum&quot;,</span>
<span class="sd">        ...               &quot;description&quot;: &quot;this is only a test&quot;}</span>
<span class="sd">        &gt;&gt;&gt; sg.schema_field_update(&quot;Asset&quot;, &quot;sg_test_number&quot;, properties)</span>
<span class="sd">        True</span>

<span class="sd">        :param entity_type: Entity type of field to update.</span>
<span class="sd">        :param field_name: Internal Shotgun name of the field to update.</span>
<span class="sd">        :param properties: Dictionary with key/value pairs where the key is the property to be</span>
<span class="sd">            updated and the value is the new value.</span>
<span class="sd">        :param dict project_entity: Optional Project entity specifying which project to modify the</span>
<span class="sd">            ``visible`` property for. If ``visible`` is present in ``properties`` and</span>
<span class="sd">            ``project_entity`` is not set, an exception will be raised. Example:</span>
<span class="sd">            ``{&#39;type&#39;: &#39;Project&#39;, &#39;id&#39;: 3}``</span>
<span class="sd">        :returns: ``True`` if the field was updated.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The ``project_entity`` parameter can only affect the state of the ``visible`` property</span>
<span class="sd">            and has no impact on other properties.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;property_name&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">((</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{}))</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_project_param</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_field_update&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.schema_field_delete"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema_field_delete">[docs]</a>    <span class="k">def</span> <span class="nf">schema_field_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the specified field from the entity type.</span>

<span class="sd">        &gt;&gt;&gt; sg.schema_field_delete(&quot;Asset&quot;, &quot;sg_temp_field&quot;)</span>
<span class="sd">        True</span>

<span class="sd">        :param str entity_type: Entity type to delete the field from.</span>
<span class="sd">        :param str field_name: Internal Shotgun name of the field to delete.</span>
<span class="sd">        :returns: ``True`` if the field was deleted.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;schema_field_delete&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.add_user_agent"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.add_user_agent">[docs]</a>    <span class="k">def</span> <span class="nf">add_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add agent to the user-agent header.</span>

<span class="sd">        Appends agent to the user-agent string sent with every API request.</span>

<span class="sd">        &gt;&gt;&gt; sg.add_user_agent(&quot;my_tool 1.0&quot;)</span>

<span class="sd">        :param str agent: string to append to user-agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.reset_user_agent"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.reset_user_agent">[docs]</a>    <span class="k">def</span> <span class="nf">reset_user_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset user agent to the default value.</span>

<span class="sd">        Example default user-agent::</span>

<span class="sd">            shotgun-json (3.0.17); Python 2.6 (Mac); ssl OpenSSL 1.0.2d 9 Jul 2015 (validate)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ua_platform</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">platform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ua_platform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>

        <span class="c1"># create ssl validation string based on settings</span>
        <span class="n">validation_str</span> <span class="o">=</span> <span class="s2">&quot;validate&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span><span class="p">:</span>
            <span class="n">validation_str</span> <span class="o">=</span> <span class="s2">&quot;no-validate&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;shotgun-json (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">__version__</span><span class="p">,</span>
                             <span class="s2">&quot;Python </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">py_version</span><span class="p">,</span> <span class="n">ua_platform</span><span class="p">),</span>
                             <span class="s2">&quot;ssl </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">ssl_version</span><span class="p">,</span> <span class="n">validation_str</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Shotgun.set_session_uuid"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.set_session_uuid">[docs]</a>    <span class="k">def</span> <span class="nf">set_session_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_uuid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the browser session_uuid in the current Shotgun API instance.</span>

<span class="sd">        When this is set, any events generated by the API will include the ``session_uuid`` value</span>
<span class="sd">        on the corresponding EventLogEntries. If there is a current browser session open with</span>
<span class="sd">        this ``session_uuid``, the browser will display updates for these events.</span>

<span class="sd">        &gt;&gt;&gt; sg.set_session_uuid(&quot;5a1d49b0-0c69-11e0-a24c-003048d17544&quot;)</span>

<span class="sd">        :param str session_uuid: The uuid of the browser session to be updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span> <span class="o">=</span> <span class="n">session_uuid</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="Shotgun.share_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.share_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">share_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities</span><span class="p">,</span> <span class="n">thumbnail_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_entity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">filmstrip_thumbnail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Associate a thumbnail with more than one Shotgun entity.</span>

<span class="sd">        .. versionadded:: 3.0.9</span>
<span class="sd">            Requires Shotgun server v4.0.0+</span>

<span class="sd">        Share the thumbnail from between entities without requiring uploading the thumbnail file</span>
<span class="sd">        multiple times. You can use this in two ways:</span>

<span class="sd">        1) Upload an image to set as the thumbnail on multiple entities.</span>
<span class="sd">        2) Update multiple entities to point to an existing entity&#39;s thumbnail.</span>

<span class="sd">        .. note::</span>
<span class="sd">            When sharing a filmstrip thumbnail, it is required to have a static thumbnail in</span>
<span class="sd">            place before the filmstrip will be displayed in the Shotgun web UI.</span>
<span class="sd">            If the :ref:`thumbnail is still processing and is using a placeholder </span>
<span class="sd">            &lt;interpreting_image_field_strings&gt;`, this method will error.</span>

<span class="sd">        Simple use case:</span>

<span class="sd">        &gt;&gt;&gt; thumb = &#39;/data/show/ne2/100_110/anim/01.mlk-02b.jpg&#39;</span>
<span class="sd">        &gt;&gt;&gt; e = [{&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 123}, {&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 456}]</span>
<span class="sd">        &gt;&gt;&gt; sg.share_thumbnail(entities=e, thumbnail_path=thumb)</span>
<span class="sd">        4271</span>

<span class="sd">        &gt;&gt;&gt; e = [{&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 123}, {&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 456}]</span>
<span class="sd">        &gt;&gt;&gt; sg.share_thumbnail(entities=e, source_entity={&#39;type&#39;:&#39;Version&#39;, &#39;id&#39;: 789})</span>
<span class="sd">        4271</span>

<span class="sd">        :param list entities: The entities to update to point to the shared  thumbnail provided in</span>
<span class="sd">            standard entity dict format::</span>

<span class="sd">                [{&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 123},</span>
<span class="sd">                 {&#39;type&#39;: &#39;Version&#39;, &#39;id&#39;: 456}]</span>
<span class="sd">        :param str thumbnail_path: The full path to the local thumbnail file to upload and share.</span>
<span class="sd">            Required if ``source_entity`` is not provided.</span>
<span class="sd">        :param dict source_entity: The entity whos thumbnail will be the source for sharing.</span>
<span class="sd">            Required if ``source_entity`` is not provided.</span>
<span class="sd">        :param bool filmstrip_thumbnail: ``True`` to share the filmstrip thumbnail. ``False`` to</span>
<span class="sd">            share the static thumbnail. Defaults to ``False``.</span>
<span class="sd">        :returns: ``id`` of the Attachment entity representing the source thumbnail that is shared.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        :raises: :class:`ShotgunError` if not supported by server version or improperly called, </span>
<span class="sd">            or :class:`ShotgunThumbnailNotReady` if thumbnail is still pending.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Thumbnail sharing support requires server &quot;</span>
                               <span class="s2">&quot;version 4.0 or higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;&#39;entities&#39; parameter must be a list of entity &quot;</span>
                               <span class="s2">&quot;hashes and may not be empty&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span> <span class="ow">or</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;&#39;entities&#39; parameter must be a list of &quot;</span>
                                   <span class="s2">&quot;entity hashes with at least &#39;type&#39; and &#39;id&#39; keys.</span><span class="se">\n</span><span class="s2">Invalid &quot;</span>
                                   <span class="s2">&quot;entity: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">thumbnail_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">source_entity</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">thumbnail_path</span> <span class="ow">and</span> <span class="n">source_entity</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;You must supply either thumbnail_path OR source_entity.&quot;</span><span class="p">)</span>

        <span class="c1"># upload thumbnail</span>
        <span class="k">if</span> <span class="n">thumbnail_path</span><span class="p">:</span>
            <span class="n">source_entity</span> <span class="o">=</span> <span class="n">entities</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filmstrip_thumbnail</span><span class="p">:</span>
                <span class="n">thumb_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_filmstrip_thumbnail</span><span class="p">(</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">thumbnail_path</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thumb_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">thumbnail_path</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_entity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_entity</span> <span class="ow">or</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_entity</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;&#39;source_entity&#39; parameter must be a dict &quot;</span>
                                   <span class="s2">&quot;with at least &#39;type&#39; and &#39;id&#39; keys.</span><span class="se">\n</span><span class="s2">Got: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                                   <span class="o">%</span> <span class="p">(</span><span class="n">source_entity</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">source_entity</span><span class="p">)))</span>

        <span class="c1"># only 1 entity in list and we already uploaded the thumbnail to it</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">thumb_id</span>

        <span class="c1"># update entities with source_entity thumbnail</span>
        <span class="n">entities_str</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">entities_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]))</span>
        <span class="c1"># format for post request</span>
        <span class="k">if</span> <span class="n">filmstrip_thumbnail</span><span class="p">:</span>
            <span class="n">filmstrip_thumbnail</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entities_str</span><span class="p">),</span>
            <span class="s2">&quot;source_entity&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">source_entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;filmstrip_thumbnail&quot;</span><span class="p">:</span> <span class="n">filmstrip_thumbnail</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                       <span class="s2">&quot;/upload/share_thumbnail&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1:&quot;</span><span class="p">):</span>
            <span class="c1"># clearing thumbnail returns no attachment_id</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attachment_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">attachment_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunThumbnailNotReady</span><span class="p">(</span><span class="s2">&quot;Unable to share thumbnail: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Unable to share thumbnail: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">attachment_id</span></div>

<div class="viewcode-block" id="Shotgun.upload_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">upload_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a file from a local path and assign it as the thumbnail for the specified entity.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Images will automatically be re-sized on the server to generate a size-appropriate image</span>
<span class="sd">            file. However, the original file is retained as well and is accessible when you click</span>
<span class="sd">            on the thumbnail image in the web UI. If you are using a local install of Shotgun and</span>
<span class="sd">            have not enabled S3, this can eat up disk space if you&#39;re uploading really large source</span>
<span class="sd">            images for your thumbnails.</span>

<span class="sd">        You can un-set (aka clear) a thumbnail on an entity using the</span>
<span class="sd">        :meth:`~shotgun_api3.Shotgun.update` method and setting the **image** field to ``None``.</span>
<span class="sd">        This will also unset the ``filmstrip_thumbnail`` field if it is set.</span>

<span class="sd">        Supported image file types include ``.jpg` and ``.png`` (preferred) but will also accept.</span>
<span class="sd">        ``.gif```, ``.tif``, ``.tiff``, ``.bmp``, ``.exr``, ``.dpx``, and ``.tga``.</span>

<span class="sd">        This method wraps over :meth:`~shotgun_api3.Shotgun.upload`. Additional keyword arguments</span>
<span class="sd">        passed to this method will be forwarded to the :meth:`~shotgun_api3.Shotgun.upload` method.</span>

<span class="sd">        :param str entity_type: Entity type to set the thumbnail for.</span>
<span class="sd">        :param int entity_id: Id of the entity to set the thumbnail for.</span>
<span class="sd">        :param str path: Full path to the thumbnail file on disk.</span>
<span class="sd">        :returns: Id of the new attachment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;thumb_image&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.upload_filmstrip_thumbnail"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload_filmstrip_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">upload_filmstrip_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload filmstrip thumbnail to specified entity.</span>

<span class="sd">        .. versionadded:: 3.0.9</span>
<span class="sd">            Requires Shotgun server v3.1.0+</span>

<span class="sd">        Uploads a file from a local directory and assigns it as the filmstrip thumbnail for the</span>
<span class="sd">        specified entity. The image must be a horizontal strip of any number of frames that are</span>
<span class="sd">        exactly 240 pixels wide. Therefore the whole strip must be an exact multiple of 240 pixels</span>
<span class="sd">        in width. The height can be anything (and will depend on the aspect ratio of the frames).</span>
<span class="sd">        Any image file type that works for thumbnails will work for filmstrip thumbnails.</span>

<span class="sd">        Filmstrip thumbnails will only be visible in the Thumbnail field on an entity if a</span>
<span class="sd">        regular thumbnail image is also uploaded to the entity. The standard thumbnail is</span>
<span class="sd">        displayed by default as the poster frame. Then, on hover, the filmstrip thumbnail is</span>
<span class="sd">        displayed and updated based on your horizontal cursor position for scrubbing. On mouseout,</span>
<span class="sd">        the default thumbnail is displayed again as the poster frame.</span>

<span class="sd">        The url for a filmstrip thumbnail on an entity is available by querying for the</span>
<span class="sd">        ``filmstrip_image field``.</span>

<span class="sd">        You can un-set (aka clear) a thumbnail on an entity using the</span>
<span class="sd">        :meth:`~shotgun_api3.Shotgun.update` method and setting the **image** field to ``None``.</span>
<span class="sd">        This will also unset the ``filmstrip_thumbnail`` field if it is set.</span>

<span class="sd">        This method wraps over :meth:`~shotgun_api3.Shotgun.upload`. Additional keyword arguments</span>
<span class="sd">        passed to this method will be forwarded to the :meth:`~shotgun_api3.Shotgun.upload` method.</span>

<span class="sd">        &gt;&gt;&gt; filmstrip_thumbnail = &#39;/data/show/ne2/100_110/anim/01.mlk-02b_filmstrip.jpg&#39;</span>
<span class="sd">        &gt;&gt;&gt; sg.upload_filmstrip_thumbnail(&quot;Version&quot;, 27, filmstrip_thumbnail)</span>
<span class="sd">        87</span>

<span class="sd">        :param str entity_type: Entity type to set the filmstrip thumbnail for.</span>
<span class="sd">        :param int entity_id: Id of the entity to set the filmstrip thumbnail for.</span>
<span class="sd">        :param str path: Full path to the filmstrip thumbnail file on disk.</span>
<span class="sd">        :returns: Id of the new Attachment entity created for the filmstrip thumbnail</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Filmstrip thumbnail support requires server version 3.1 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;filmstrip_thumb_image&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.upload"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.upload">[docs]</a>    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">tag_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload a file to the specified entity.</span>

<span class="sd">        Creates an Attachment entity for the file in Shotgun and links it to the specified entity.</span>
<span class="sd">        You can optionally store the file in a field on the entity, change the display name, and</span>
<span class="sd">        assign tags to the Attachment.</span>

<span class="sd">        .. note::</span>
<span class="sd">          Make sure to have retries for file uploads. Failures when uploading will occasionally happen. </span>
<span class="sd">          When it does, immediately retrying to upload usually works</span>

<span class="sd">        &gt;&gt;&gt; mov_file = &#39;/data/show/ne2/100_110/anim/01.mlk-02b.mov&#39;</span>
<span class="sd">        &gt;&gt;&gt; sg.upload(&quot;Shot&quot;, 423, mov_file, field_name=&quot;sg_latest_quicktime&quot;,</span>
<span class="sd">        ...           display_name=&quot;Latest QT&quot;)</span>
<span class="sd">        72</span>

<span class="sd">        :param str entity_type: Entity type to link the upload to.</span>
<span class="sd">        :param int entity_id: Id of the entity to link the upload to.</span>
<span class="sd">        :param str path: Full path to an existing non-empty file on disk to upload.</span>
<span class="sd">        :param str field_name: The internal Shotgun field name on the entity to store the file in.</span>
<span class="sd">            This field must be a File/Link field type.</span>
<span class="sd">        :param str display_name: The display name to use for the file. Defaults to the file name.</span>
<span class="sd">        :param str tag_list: comma-separated string of tags to assign to the file.</span>
<span class="sd">        :returns: Id of the Attachment entity that was created for the image.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        :raises: :class:`ShotgunError` on upload failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic validations of the file to upload.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># We need to check for string encodings that we aren&#39;t going to be able</span>
        <span class="c1"># to support later in the upload process. If the given path wasn&#39;t already</span>
        <span class="c1"># unicode, we will try to decode it as utf-8, and if that fails then we</span>
        <span class="c1"># have to raise a sane exception. This will always work for ascii and utf-8</span>
        <span class="c1"># encoded strings, but will fail on some others if the string includes non</span>
        <span class="c1"># ascii characters.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span>
                    <span class="s2">&quot;Could not upload the given file path. It is encoded as &quot;</span>
                    <span class="s2">&quot;something other than utf-8 or ascii. To upload this file, &quot;</span>
                    <span class="s2">&quot;it can be string encoded as utf-8, or given as unicode: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Path must be a valid file, got &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Path cannot be an empty file: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">is_thumbnail</span> <span class="o">=</span> <span class="p">(</span><span class="n">field_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thumb_image&quot;</span><span class="p">,</span> <span class="s2">&quot;filmstrip_thumb_image&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;filmstrip_image&quot;</span><span class="p">])</span>

        <span class="c1"># Supported types can be directly uploaded to Cloud storage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requires_direct_s3_upload</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_storage</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span>
                                           <span class="n">tag_list</span><span class="p">,</span> <span class="n">is_thumbnail</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_to_sg</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span>
                                      <span class="n">tag_list</span><span class="p">,</span> <span class="n">is_thumbnail</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_upload_to_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span>
                           <span class="n">tag_list</span><span class="p">,</span> <span class="n">is_thumbnail</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to upload a file to the Cloud storage and link it to the specified entity.</span>

<span class="sd">        :param str entity_type: Entity type to link the upload to.</span>
<span class="sd">        :param int entity_id: Id of the entity to link the upload to.</span>
<span class="sd">        :param str path: Full path to an existing non-empty file on disk to upload.</span>
<span class="sd">        :param str field_name: The internal Shotgun field name on the entity to store the file in.</span>
<span class="sd">            This field must be a File/Link field type.</span>
<span class="sd">        :param str display_name: The display name to use for the file. Defaults to the file name.</span>
<span class="sd">        :param str tag_list: comma-separated string of tags to assign to the file.</span>
<span class="sd">        :param bool is_thumbnail: indicates if the attachment is a thumbnail.</span>
<span class="sd">        :returns: Id of the Attachment entity that was created for the image.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Step 1: get the upload url</span>

        <span class="n">is_multipart_upload</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MULTIPART_UPLOAD_CHUNK_SIZE</span><span class="p">)</span>

        <span class="n">upload_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attachment_upload_info</span><span class="p">(</span><span class="n">is_thumbnail</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">is_multipart_upload</span><span class="p">)</span>

        <span class="c1"># Step 2: upload the file</span>
        <span class="c1"># We upload large files in multiple parts because it is more robust</span>
        <span class="c1"># (and required when using S3 storage)</span>
        <span class="k">if</span> <span class="n">is_multipart_upload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multipart_upload_file_to_storage</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_file_to_storage</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_url&quot;</span><span class="p">])</span>

        <span class="c1"># Step 3: create the attachment</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                       <span class="s2">&quot;/upload/api_link_file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;entity_id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
            <span class="s2">&quot;upload_link_info&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_info&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">is_thumbnail</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;filmstrip_thumb_image&quot;</span> <span class="ow">or</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;filmstrip_image&quot;</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filmstrip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">display_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">display_name</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="c1"># we allow linking to nothing for generic reference use cases</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_name</span>
            <span class="c1"># None gets converted to a string and added as a tag...</span>
            <span class="k">if</span> <span class="n">tag_list</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tag_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_list</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Could not upload file successfully, but &quot;</span>
                               <span class="s2">&quot;not sure why.</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Url: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Error: </span><span class="si">%s</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attachment linked to content on Cloud storage&quot;</span><span class="p">)</span>

        <span class="n">attachment_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">attachment_id</span>

    <span class="k">def</span> <span class="nf">_upload_to_sg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">display_name</span><span class="p">,</span>
                      <span class="n">tag_list</span><span class="p">,</span> <span class="n">is_thumbnail</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to upload a file to Shotgun and link it to the specified entity.</span>

<span class="sd">        :param str entity_type: Entity type to link the upload to.</span>
<span class="sd">        :param int entity_id: Id of the entity to link the upload to.</span>
<span class="sd">        :param str path: Full path to an existing non-empty file on disk to upload.</span>
<span class="sd">        :param str field_name: The internal Shotgun field name on the entity to store the file in.</span>
<span class="sd">            This field must be a File/Link field type.</span>
<span class="sd">        :param str display_name: The display name to use for the file. Defaults to the file name.</span>
<span class="sd">        :param str tag_list: comma-separated string of tags to assign to the file.</span>
<span class="sd">        :param bool is_thumbnail: indicates if the attachment is a thumbnail.</span>

<span class="sd">        :returns: Id of the Attachment entity that was created for the image.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;entity_id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">is_thumbnail</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                           <span class="s2">&quot;/upload/publish_thumbnail&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;thumb_image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;filmstrip_thumb_image&quot;</span> <span class="ow">or</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;filmstrip_image&quot;</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filmstrip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                           <span class="s2">&quot;/upload/upload_file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">display_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">display_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># we allow linking to nothing for generic reference use cases</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;field_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_name</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_name</span>
            <span class="c1"># None gets converted to a string and added as a tag...</span>
            <span class="k">if</span> <span class="n">tag_list</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;tag_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_list</span>

            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Could not upload file successfully, but &quot;</span>
                               <span class="s2">&quot;not sure why.</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Url: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Error: </span><span class="si">%s</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

        <span class="n">attachment_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">attachment_id</span>

    <span class="k">def</span> <span class="nf">_get_attachment_upload_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_thumbnail</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">is_multipart_upload</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to get the information needed to upload a file to Cloud storage.</span>

<span class="sd">        :param bool is_thumbnail: indicates if the attachment is a thumbnail.</span>
<span class="sd">        :param str filename: name of the file that will be uploaded.</span>
<span class="sd">        :param bool is_multipart_upload: Indicates if we want multi-part upload information back.</span>

<span class="sd">        :returns: dictionary containing upload details from the server.</span>
<span class="sd">            These details are used throughout the upload process.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">is_thumbnail</span><span class="p">:</span>
            <span class="n">upload_type</span> <span class="o">=</span> <span class="s2">&quot;Thumbnail&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">upload_type</span> <span class="o">=</span> <span class="s2">&quot;Attachment&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;upload_type&quot;</span><span class="p">:</span> <span class="n">upload_type</span><span class="p">,</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span>
        <span class="p">}</span>

        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;multipart_upload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_multipart_upload</span>

        <span class="n">upload_url</span> <span class="o">=</span> <span class="s2">&quot;/upload/api_get_upload_link_info&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">upload_url</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">upload_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">upload_info</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Could not get upload_url but &quot;</span>
                               <span class="s2">&quot;not sure why.</span><span class="se">\n</span><span class="s2">Path: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Url: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Error: </span><span class="si">%s</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">))</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed rpc call to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">upload_url</span><span class="p">))</span>

        <span class="n">upload_info_parts</span> <span class="o">=</span> <span class="n">upload_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;upload_url&quot;</span><span class="p">:</span> <span class="n">upload_info_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">upload_info_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;upload_type&quot;</span><span class="p">:</span> <span class="n">upload_info_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="s2">&quot;upload_id&quot;</span><span class="p">:</span> <span class="n">upload_info_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;upload_info&quot;</span><span class="p">:</span> <span class="n">upload_info</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Shotgun.download_attachment"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.download_attachment">[docs]</a>    <span class="k">def</span> <span class="nf">download_attachment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attachment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attachment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download the file associated with a Shotgun Attachment.</span>

<span class="sd">            &gt;&gt;&gt; version = sg.find_one(&quot;Version&quot;, [[&quot;id&quot;, &quot;is&quot;, 7115]], [&quot;sg_uploaded_movie&quot;])</span>
<span class="sd">            &gt;&gt;&gt; local_file_path = &quot;/var/tmp/%s&quot; % version[&quot;sg_uploaded_movie&quot;][&quot;name&quot;]</span>
<span class="sd">            &gt;&gt;&gt; sg.download_attachment(version[&quot;sg_uploaded_movie&quot;], file_path=local_file_path)</span>
<span class="sd">            /var/tmp/100b_scene_output_v032.mov</span>

<span class="sd">        .. warning::</span>

<span class="sd">            On older (&lt; v5.1.0) Shotgun versions, non-downloadable files</span>
<span class="sd">            on Shotgun don&#39;t raise exceptions, they cause a server error which</span>
<span class="sd">            returns a 200 with the page content.</span>

<span class="sd">        :param dict attachment: Usually a dictionary representing an Attachment entity.</span>
<span class="sd">            The dictionary should have a ``url`` key that specifies the download url.</span>
<span class="sd">            Optionally, the dictionary can be a standard entity hash format with ``id`` and</span>
<span class="sd">            ``type`` keys as long as ``&quot;type&quot;==&quot;Attachment&quot;``. This is only supported for</span>
<span class="sd">            backwards compatibility (#22150).</span>

<span class="sd">            If an int value is passed in, the Attachment entity with the matching id will</span>
<span class="sd">            be downloaded from the Shotgun server.</span>
<span class="sd">        :param str file_path: Optional file path to write the data directly to local disk. This</span>
<span class="sd">            avoids loading all of the data in memory and saves the file locally at the given path.</span>
<span class="sd">        :param id attachment_id: (deprecated) Optional ``id`` of the Attachment entity in Shotgun to</span>
<span class="sd">            download.</span>

<span class="sd">            .. note:</span>
<span class="sd">                This parameter exists only for backwards compatibility for scripts specifying</span>
<span class="sd">                the parameter with keywords.</span>
<span class="sd">        :returns: If ``file_path`` is provided, returns the path to the file on disk.  If</span>
<span class="sd">            ``file_path`` is ``None``, returns the actual data of the file, as str in Python 2 or</span>
<span class="sd">            bytes in Python 3.</span>
<span class="sd">        :rtype: str | bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># backwards compatibility when passed via keyword argument</span>
        <span class="k">if</span> <span class="n">attachment</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">attachment_id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">attachment</span> <span class="o">=</span> <span class="n">attachment_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Missing parameter &#39;attachment&#39;. Expected a &quot;</span>
                                <span class="s2">&quot;dict, int, NoneType value or&quot;</span>
                                <span class="s2">&quot;an int for parameter attachment_id&quot;</span><span class="p">)</span>
        <span class="c1"># write to disk</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Unable to write Attachment to disk using &quot;</span>
                              <span class="s2">&quot;file_path. </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attachment_download_url</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">cookie_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
            <span class="c1"># We only need to set the auth cookie for downloads from Shotgun server</span>
            <span class="n">cookie_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_auth_cookie_handler</span><span class="p">()</span>

        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">cookie_handler</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;user-agent&quot;</span><span class="p">,</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">))</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attachment</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># 400 [sg] Attachment id doesn&#39;t exist or is a local file</span>
        <span class="c1"># 403 [s3] link is invalid</span>
        <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Failed to open </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Attachment may not exist or is a local file?&quot;</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                    <span class="c1"># Only parse the body if it is an Amazon S3 url.</span>
                    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;s3.amazonaws.com&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;content-type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;application/xml&quot;</span><span class="p">:</span>
                        <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
                        <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
                            <span class="n">xml</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
                            <span class="c1"># Once python 2.4 support is not needed we can think about using</span>
                            <span class="c1"># elementtree. The doc is pretty small so this shouldn&#39;t be an issue.</span>
                            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;&lt;Message&gt;(.*)&lt;/Message&gt;&quot;</span><span class="p">,</span> <span class="n">xml</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                                <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot; - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">409</span> <span class="ow">or</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">410</span><span class="p">:</span>
                    <span class="c1"># we may be dealing with a file that is pending/failed a malware scan, e.g:</span>
                    <span class="c1"># 409: This file is undergoing a malware scan, please try again in a few minutes</span>
                    <span class="c1"># 410: File scanning has detected malware and the file has been quarantined</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                        <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ShotgunFileDownloadError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fp</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">file_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">attachment</span></div>

<div class="viewcode-block" id="Shotgun.get_auth_cookie_handler"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.get_auth_cookie_handler">[docs]</a>    <span class="k">def</span> <span class="nf">get_auth_cookie_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an urllib cookie handler containing a cookie for FPTR</span>
<span class="sd">        authentication.</span>

<span class="sd">        Looks up session token and sets that in a cookie in the :mod:`urllib2`</span>
<span class="sd">        handler.</span>
<span class="sd">        This is used internally for downloading attachments from FPTR.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session_token</span><span class="p">()</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">http_cookiejar</span><span class="o">.</span><span class="n">LWPCookieJar</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">http_cookiejar</span><span class="o">.</span><span class="n">Cookie</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;_session_id&quot;</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cj</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.get_attachment_download_url"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.get_attachment_download_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_attachment_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attachment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the URL for downloading provided Attachment.</span>

<span class="sd">        :param mixed attachment: Usually a dict representing An Attachment entity in Shotgun to</span>
<span class="sd">            return the download url for. If the ``url`` key is present, it will be used as-is for</span>
<span class="sd">            the download url. If the ``url`` key is not present, a url will be constructed pointing</span>
<span class="sd">            at the current Shotgun server for downloading the Attachment entity using the ``id``.</span>

<span class="sd">            If ``None`` is passed in, it is silently ignored in order to avoid raising an error when</span>
<span class="sd">            results from a :meth:`~shotgun_api3.Shotgun.find` are passed off to</span>
<span class="sd">            :meth:`~shotgun_api3.Shotgun.download_attachment`</span>

<span class="sd">        .. note::</span>
<span class="sd">            Support for passing in an int representing the Attachment ``id`` is deprecated</span>

<span class="sd">        :returns: the download URL for the Attachment or ``None`` if ``None`` was passed to</span>
<span class="sd">            ``attachment`` parameter.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Support for a standard entity hash should be removed: #22150</span>
        <span class="n">attachment_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">attachment_id</span> <span class="o">=</span> <span class="n">attachment</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attachment</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">attachment</span> <span class="ow">and</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">attachment</span> <span class="ow">and</span> <span class="n">attachment</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Attachment&quot;</span><span class="p">):</span>
                    <span class="n">attachment_id</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing &#39;url&#39; key in Attachment dict&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attachment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unable to determine download url. Expected &quot;</span>
                            <span class="s2">&quot;dict, int, or NoneType. Instead got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">attachment</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">attachment_id</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                           <span class="s2">&quot;/file_serve/attachment/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">attachment_id</span><span class="p">)),</span>
                                           <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url</span></div>

<div class="viewcode-block" id="Shotgun.authenticate_human_user"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.authenticate_human_user">[docs]</a>    <span class="k">def</span> <span class="nf">authenticate_human_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_login</span><span class="p">,</span> <span class="n">user_password</span><span class="p">,</span> <span class="n">auth_token</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate Shotgun HumanUser.</span>

<span class="sd">        Authenticates a user given the login, password, and optionally, one-time auth token (when</span>
<span class="sd">        two-factor authentication is required). The user must be a ``HumanUser`` entity and the</span>
<span class="sd">        account must be active.</span>

<span class="sd">        &gt;&gt;&gt; sg.authenticate_human_user(&quot;rhendriks&quot;, &quot;c0mPre$Hi0n&quot;, None)</span>
<span class="sd">        {&quot;type&quot;: &quot;HumanUser&quot;, &quot;id&quot;: 123, &quot;name&quot;: &quot;Richard Hendriks&quot;}</span>

<span class="sd">        :param str user_login: Login name of Shotgun HumanUser</span>
<span class="sd">        :param str user_password: Password for Shotgun HumanUser</span>
<span class="sd">        :param str auth_token: One-time token required to authenticate Shotgun HumanUser</span>
<span class="sd">            when two-factor authentication is turned on.</span>
<span class="sd">        :returns: Standard Shotgun dictionary representing the HumanUser if authentication</span>
<span class="sd">            succeeded. ``None`` if authentication failed for any reason.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_login</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please supply a username to authenticate.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_password</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please supply a password for the user.&quot;</span><span class="p">)</span>

        <span class="c1"># Override permissions on Config obj</span>
        <span class="n">original_login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span>
        <span class="n">original_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span>
        <span class="n">original_auth_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">user_login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">user_password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">auth_token</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s2">&quot;HumanUser&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;sg_status_list&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;act&quot;</span><span class="p">],</span>
                                               <span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">user_login</span><span class="p">]],</span>
                                 <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span>
            <span class="c1"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">Fault</span><span class="p">:</span>
            <span class="c1"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Set back to default - There finally and except cannot be used together in python2.4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="o">=</span> <span class="n">original_login</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span> <span class="o">=</span> <span class="n">original_password</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span> <span class="o">=</span> <span class="n">original_auth_token</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="Shotgun.update_project_last_accessed"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.update_project_last_accessed">[docs]</a>    <span class="k">def</span> <span class="nf">update_project_last_accessed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a Project&#39;s ``last_accessed_by_current_user`` field to the current timestamp.</span>

<span class="sd">        This helps keep track of the recent Projects each user has worked on and enables scripts</span>
<span class="sd">        and apps to use this information to display &quot;Recent Projects&quot; for users as a convenience.</span>

<span class="sd">        .. versionadded::</span>
<span class="sd">            Requires Shotgun v5.3.20+</span>

<span class="sd">        &gt;&gt;&gt; sg.update_project_last_accessed({&quot;type&quot;: &quot;Project&quot;, &quot;id&quot;: 66},</span>
<span class="sd">        ...                                 {&quot;type&quot;: &quot;HumanUser&quot;, &quot;id&quot;: 43})</span>

<span class="sd">        :param dict project: Standard Project entity dictionary</span>
<span class="sd">        :param dict user: Standard user entity dictionary. This is optional if the current API</span>
<span class="sd">            instance is using user-based authenitcation, or has specified ``sudo_as_login``. In</span>
<span class="sd">            these cases, if ``user`` is not provided, the ``sudo_as_login`` value or ``login``</span>
<span class="sd">            value from the current instance will be used instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;update_project_last_accessed requires server version 5.3.20 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="c1"># Try to use sudo as user if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s2">&quot;HumanUser&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">]])</span>
            <span class="c1"># Try to use login if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="s2">&quot;HumanUser&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">]])</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;project_id&quot;</span><span class="p">:</span> <span class="n">project</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;update_project_last_accessed_by_current_user&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Shotgun.note_thread_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.note_thread_read">[docs]</a>    <span class="k">def</span> <span class="nf">note_thread_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">,</span> <span class="n">entity_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full conversation for a given note, including Replies and Attachments.</span>

<span class="sd">        Returns a complex data structure on the following form::</span>

<span class="sd">            [{&#39;content&#39;: &#39;Please add more awesomeness to the color grading.&#39;,</span>
<span class="sd">              &#39;created_at&#39;: &#39;2015-07-14 21:33:28 UTC&#39;,</span>
<span class="sd">              &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                             &#39;name&#39;: &#39;John Pink&#39;,</span>
<span class="sd">                             &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                             &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                             &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">              &#39;id&#39;: 6013,</span>
<span class="sd">              &#39;type&#39;: &#39;Note&#39;},</span>
<span class="sd">             {&#39;created_at&#39;: &#39;2015-07-14 21:33:32 UTC&#39;,</span>
<span class="sd">              &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                             &#39;name&#39;: &#39;John Pink&#39;,</span>
<span class="sd">                             &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                             &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                             &#39;valid&#39;: &#39;valid&#39;},</span>
<span class="sd">              &#39;id&#39;: 159,</span>
<span class="sd">              &#39;type&#39;: &#39;Attachment&#39;},</span>
<span class="sd">             {&#39;content&#39;: &#39;More awesomeness added&#39;,</span>
<span class="sd">              &#39;created_at&#39;: &#39;2015-07-14 21:54:51 UTC&#39;,</span>
<span class="sd">              &#39;id&#39;: 5,</span>
<span class="sd">              &#39;type&#39;: &#39;Reply&#39;,</span>
<span class="sd">              &#39;user&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                       &#39;name&#39;: &#39;David Blue&#39;,</span>
<span class="sd">                       &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                       &#39;type&#39;: &#39;HumanUser&#39;,</span>
<span class="sd">                       &#39;valid&#39;: &#39;valid&#39;}}]</span>

<span class="sd">        The list is returned in descending chronological order.</span>

<span class="sd">        If you wish to include additional fields beyond the ones that are</span>
<span class="sd">        returned by default, you can specify these in an entity_fields</span>
<span class="sd">        dictionary. This dictionary should be keyed by entity type and each</span>
<span class="sd">        key should contain a list of fields to retrieve, for example::</span>

<span class="sd">            { &quot;Note&quot;:       [&quot;created_by.HumanUser.image&quot;,</span>
<span class="sd">                             &quot;addressings_to&quot;,</span>
<span class="sd">                             &quot;playlist&quot;,</span>
<span class="sd">                             &quot;user&quot; ],</span>
<span class="sd">              &quot;Reply&quot;:      [&quot;content&quot;],</span>
<span class="sd">              &quot;Attachment&quot;: [&quot;filmstrip_image&quot;,</span>
<span class="sd">                            &quot;local_storage&quot;,</span>
<span class="sd">                            &quot;this_file&quot;,</span>
<span class="sd">                            &quot;image&quot;]</span>
<span class="sd">            }</span>

<span class="sd">        :param int note_id: The id for the note to be retrieved</span>
<span class="sd">        :param dict entity_fields: Additional fields to retrieve as part of the request.</span>
<span class="sd">            See above for details.</span>
<span class="sd">        :returns: A list of dictionaries. See above for example.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;note_thread requires server version 6.2.0 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">entity_fields</span> <span class="o">=</span> <span class="n">entity_fields</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;entity_fields parameter must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;note_id&quot;</span><span class="p">:</span> <span class="n">note_id</span><span class="p">,</span> <span class="s2">&quot;entity_fields&quot;</span><span class="p">:</span> <span class="n">entity_fields</span><span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;note_thread_contents&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Shotgun.text_search"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.text_search">[docs]</a>    <span class="k">def</span> <span class="nf">text_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">,</span> <span class="n">project_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search across the specified entity types for the given text.</span>

<span class="sd">        This method can be used to implement auto completion or a Shotgun global search. The method</span>
<span class="sd">        requires a text input phrase that is at least three characters long, or an exception will</span>
<span class="sd">        be raised.</span>

<span class="sd">        Several ways to limit the results of the query are available:</span>

<span class="sd">        - Using the ``project_ids`` parameter, you can provide a list of Project ids to search</span>
<span class="sd">          across. Leaving this at its default value of ``None`` will search across all Shotgun data.</span>

<span class="sd">        - You need to define which subset of entity types to search using the ``entity_types``</span>
<span class="sd">          parameter. Each of these entity types can be associated with a filter query to further</span>
<span class="sd">          reduce the list of matches. The filter list is using the standard filter syntax used by</span>
<span class="sd">          for example the :meth:`~shotgun_api3.Shotgun.find` method.</span>

<span class="sd">        **Example: Constrain the search to all Tasks but Character Assets only**</span>

<span class="sd">        &gt;&gt;&gt; entity_types = {</span>
<span class="sd">        ...     &quot;Asset&quot;: [[&quot;sg_asset_type&quot;, &quot;is&quot;, &quot;Character&quot;]],</span>
<span class="sd">        ...     &quot;Task&quot;: []</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; sg.text_search(&quot;bunny&quot;, entity_types)</span>
<span class="sd">        {&#39;matches&#39;: [{&#39;id&#39;: 734,</span>
<span class="sd">                      &#39;type&#39;: &#39;Asset&#39;,</span>
<span class="sd">                      &#39;name&#39;: &#39;Bunny&#39;,</span>
<span class="sd">                      &#39;project_id&#39;: 65,</span>
<span class="sd">                      &#39;image&#39;: &#39;https://...&#39;,</span>
<span class="sd">                      &#39;links&#39;: [&#39;&#39;, &#39;&#39;],</span>
<span class="sd">                      &#39;status&#39;: &#39;fin&#39;},</span>
<span class="sd">                      ...</span>
<span class="sd">                      {&#39;id&#39;: 558,</span>
<span class="sd">                       &#39;type&#39;: &#39;Task&#39;</span>
<span class="sd">                       &#39;name&#39;: &#39;FX&#39;,</span>
<span class="sd">                       &#39;project_id&#39;: 65,</span>
<span class="sd">                       &#39;image&#39;: &#39;https://...&#39;,</span>
<span class="sd">                       &#39;links&#39;: [&#39;Shot&#39;, &#39;bunny_010_0010&#39;],</span>
<span class="sd">                       &#39;status&#39;: &#39;fin&#39;}],</span>
<span class="sd">            &#39;terms&#39;: [&#39;bunny&#39;]}</span>

<span class="sd">        The links field will contain information about any linked entity. This is useful when, for</span>
<span class="sd">        example, presenting Tasks and you want to display what Shot or Asset the Task is associated</span>
<span class="sd">        with.</span>

<span class="sd">        :param str text: Text to search for. This must be at least three characters long, or an</span>
<span class="sd">            exception will be raised.</span>
<span class="sd">        :param dict entity_types: Dictionary to specify which entity types to search across. See</span>
<span class="sd">            above for usage examples.</span>
<span class="sd">        :param list project_ids: List of Projects to search. By default, all projects will be</span>
<span class="sd">            searched.</span>
<span class="sd">        :param int limit: Specify the maximum number of matches to return.</span>
<span class="sd">        :returns: A complex dictionary structure, see above for example.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;auto_complete requires server version 6.2.0 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="c1"># convert entity_types structure into the form</span>
        <span class="c1"># that the API endpoint expects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_types</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;entity_types parameter must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">api_entity_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">filter_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">entity_types</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">resolved_filters</span> <span class="o">=</span> <span class="n">_translate_filters</span><span class="p">(</span><span class="n">filter_list</span><span class="p">,</span> <span class="n">filter_operator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">api_entity_types</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved_filters</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value of entity_types[&#39;</span><span class="si">%s</span><span class="s2">&#39;] must &quot;</span>
                                 <span class="s2">&quot;be a list or tuple.&quot;</span> <span class="o">%</span> <span class="n">entity_type</span><span class="p">)</span>

        <span class="n">project_ids</span> <span class="o">=</span> <span class="n">project_ids</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                  <span class="s2">&quot;entity_types&quot;</span><span class="p">:</span> <span class="n">api_entity_types</span><span class="p">,</span>
                  <span class="s2">&quot;project_ids&quot;</span><span class="p">:</span> <span class="n">project_ids</span><span class="p">,</span>
                  <span class="s2">&quot;max_results&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;query_display_name_cache&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Shotgun.activity_stream_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.activity_stream_read">[docs]</a>    <span class="k">def</span> <span class="nf">activity_stream_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">entity_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">max_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve activity stream data from Shotgun.</span>

<span class="sd">        This data corresponds to the data that is displayed in the</span>
<span class="sd">        Activity tab for an entity in the Shotgun Web UI.</span>

<span class="sd">        A complex data structure on the following form will be</span>
<span class="sd">        returned from Shotgun::</span>

<span class="sd">            {&#39;earliest_update_id&#39;: 50,</span>
<span class="sd">             &#39;entity_id&#39;: 65,</span>
<span class="sd">             &#39;entity_type&#39;: &#39;Project&#39;,</span>
<span class="sd">             &#39;latest_update_id&#39;: 79,</span>
<span class="sd">             &#39;updates&#39;: [{&#39;created_at&#39;: &#39;2015-07-15 11:06:55 UTC&#39;,</span>
<span class="sd">                          &#39;created_by&#39;: {&#39;id&#39;: 38,</span>
<span class="sd">                                         &#39;image&#39;: &#39;6641&#39;,</span>
<span class="sd">                                         &#39;name&#39;: &#39;John Smith&#39;,</span>
<span class="sd">                                         &#39;status&#39;: &#39;act&#39;,</span>
<span class="sd">                                         &#39;type&#39;: &#39;HumanUser&#39;},</span>
<span class="sd">                          &#39;id&#39;: 79,</span>
<span class="sd">                          &#39;meta&#39;: {&#39;entity_id&#39;: 6004,</span>
<span class="sd">                                   &#39;entity_type&#39;: &#39;Version&#39;,</span>
<span class="sd">                                   &#39;type&#39;: &#39;new_entity&#39;},</span>
<span class="sd">                          &#39;primary_entity&#39;: {&#39;id&#39;: 6004,</span>
<span class="sd">                                             &#39;name&#39;: &#39;Review_turntable_v2&#39;,</span>
<span class="sd">                                             &#39;status&#39;: &#39;rev&#39;,</span>
<span class="sd">                                             &#39;type&#39;: &#39;Version&#39;},</span>
<span class="sd">                          &#39;read&#39;: False,</span>
<span class="sd">                          &#39;update_type&#39;: &#39;create&#39;},</span>
<span class="sd">                         {...},</span>
<span class="sd">                        ]</span>
<span class="sd">            }</span>

<span class="sd">        The main payload of the return data can be found inside the &#39;updates&#39;</span>
<span class="sd">        key, containing a list of dictionaries. This list is always returned</span>
<span class="sd">        in descending date order. Each item may contain different fields</span>
<span class="sd">        depending on their update type. The primary_entity key represents the</span>
<span class="sd">        main Shotgun entity that is associated with the update. By default,</span>
<span class="sd">        this entity is returned with a set of standard fields. By using the</span>
<span class="sd">        entity_fields parameter, you can extend the returned data to include</span>
<span class="sd">        additional fields. If for example you wanted to return the asset type</span>
<span class="sd">        for all assets and the linked sequence for all Shots, pass the</span>
<span class="sd">        following entity_fields::</span>

<span class="sd">            {&quot;Shot&quot;: [&quot;sg_sequence&quot;], &quot;Asset&quot;: [&quot;sg_asset_type&quot;]}</span>

<span class="sd">        Deep queries can be used in this syntax if you want to</span>
<span class="sd">        traverse into connected data.</span>

<span class="sd">        :param str entity_type: Entity type to retrieve activity stream for</span>
<span class="sd">        :param int entity_id: Entity id to retrieve activity stream for</span>
<span class="sd">        :param list entity_fields: List of additional fields to include.</span>
<span class="sd">                              See above for details</span>
<span class="sd">        :param int max_id: Do not retrieve ids greater than this id.</span>
<span class="sd">                       This is useful when implementing paging.</span>
<span class="sd">        :param int min_id: Do not retrieve ids lesser than this id.</span>
<span class="sd">                       This is useful when implementing caching of</span>
<span class="sd">                       the event stream data and you want to</span>
<span class="sd">                       &quot;top up&quot; an existing cache.</span>
<span class="sd">        :param int limit: Limit the number of returned records. If not specified,</span>
<span class="sd">                      the system default will be used.</span>
<span class="sd">        :returns: A complex activity stream data structure. See above for details.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;activity_stream requires server version 6.2.0 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="c1"># set up parameters to send to server.</span>
        <span class="n">entity_fields</span> <span class="o">=</span> <span class="n">entity_fields</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;entity_fields parameter must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entity_id</span><span class="p">,</span>
                  <span class="s2">&quot;max_id&quot;</span><span class="p">:</span> <span class="n">max_id</span><span class="p">,</span>
                  <span class="s2">&quot;min_id&quot;</span><span class="p">:</span> <span class="n">min_id</span><span class="p">,</span>
                  <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                  <span class="s2">&quot;entity_fields&quot;</span><span class="p">:</span> <span class="n">entity_fields</span><span class="p">}</span>

        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;activity_stream&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_records</span><span class="p">(</span><span class="n">record</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">nav_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">seed_entity_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entity_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expand the navigation hierarchy for the supplied path.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This is an experimental method that is not officially part of the</span>
<span class="sd">            python-api. Usage of this method is discouraged. This method&#39;s name,</span>
<span class="sd">            arguments, and argument types may change at any point.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span>
            <span class="s2">&quot;nav_expand&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                <span class="s2">&quot;seed_entity_field&quot;</span><span class="p">:</span> <span class="n">seed_entity_field</span><span class="p">,</span>
                <span class="s2">&quot;entity_fields&quot;</span><span class="p">:</span> <span class="n">entity_fields</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">nav_search_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">search_string</span><span class="p">,</span> <span class="n">seed_entity_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search function adapted to work with the navigation hierarchy.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This is an experimental method that is not officially part of the</span>
<span class="sd">            python-api. Usage of this method is discouraged. This method&#39;s name,</span>
<span class="sd">            arguments, and argument types may change at any point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span>
            <span class="s2">&quot;nav_search&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;root_path&quot;</span><span class="p">:</span> <span class="n">root_path</span><span class="p">,</span>
                <span class="s2">&quot;seed_entity_field&quot;</span><span class="p">:</span> <span class="n">seed_entity_field</span><span class="p">,</span>
                <span class="s2">&quot;search_criteria&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;search_string&quot;</span><span class="p">:</span> <span class="n">search_string</span><span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">nav_search_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">seed_entity_field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search function adapted to work with the navigation hierarchy.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This is an experimental method that is not officially part of the</span>
<span class="sd">            python-api. Usage of this method is discouraged. This method&#39;s name,</span>
<span class="sd">            arguments, and argument types may change at any point.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span>
            <span class="s2">&quot;nav_search&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;root_path&quot;</span><span class="p">:</span> <span class="n">root_path</span><span class="p">,</span>
                <span class="s2">&quot;seed_entity_field&quot;</span><span class="p">:</span> <span class="n">seed_entity_field</span><span class="p">,</span>
                <span class="s2">&quot;search_criteria&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;entity&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Shotgun.get_session_token"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.get_session_token">[docs]</a>    <span class="k">def</span> <span class="nf">get_session_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the session token associated with the current session.</span>

<span class="sd">        If a session token has already been established, this is returned, otherwise a new one is</span>
<span class="sd">        generated on the server and returned.</span>

<span class="sd">        &gt;&gt;&gt; sg.get_session_token()</span>
<span class="sd">        dd638be7d07c39fa73d935a775558a50</span>

<span class="sd">        :returns: String containing a session token.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span>

        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;get_session_token&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">session_token</span> <span class="o">=</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;session_id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">session_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not extract session_id from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="n">session_token</span>

        <span class="k">return</span> <span class="n">session_token</span></div>

<div class="viewcode-block" id="Shotgun.preferences_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.preferences_read">[docs]</a>    <span class="k">def</span> <span class="nf">preferences_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a subset of the site preferences.</span>

<span class="sd">        &gt;&gt;&gt; sg.preferences_read()</span>
<span class="sd">        {</span>
<span class="sd">            &quot;pref_name&quot;: &quot;pref value&quot;</span>
<span class="sd">        }</span>

<span class="sd">        :param list prefs: An optional list of preference names to return.</span>
<span class="sd">        :returns: Dictionary of preferences and their values.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;preferences_read requires server version 7.10.0 or &quot;</span>
                               <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

        <span class="n">prefs</span> <span class="o">=</span> <span class="n">prefs</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;preferences_read&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;prefs&quot;</span><span class="p">:</span> <span class="n">prefs</span><span class="p">})</span></div>

<div class="viewcode-block" id="Shotgun.user_subscriptions_read"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.user_subscriptions_read">[docs]</a>    <span class="k">def</span> <span class="nf">user_subscriptions_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of user subscriptions.</span>

<span class="sd">        :returns: A list of user subscriptions where each subscription is a</span>
<span class="sd">            dictionary containing the ``humanUserId`` and ``subscription``</span>
<span class="sd">            fields.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span><span class="s2">&quot;user_subscriptions_read&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.user_subscriptions_create"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.user_subscriptions_create">[docs]</a>    <span class="k">def</span> <span class="nf">user_subscriptions_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
        <span class="c1"># type: (list[dict[str, Union[str, list[str], None]) -&gt; bool</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign subscriptions to users.</span>

<span class="sd">        :param list users: list of user subscriptions to assign.</span>
<span class="sd">            Each subscription must be a dictionary with the ``humanUserId`` and</span>
<span class="sd">            ``subscription`` fields.</span>
<span class="sd">            The ``subscription`` is either ``None``, a single string, or an</span>
<span class="sd">            array of strings with subscription information.</span>

<span class="sd">        :returns: ``True`` if the request succedeed, ``False`` if otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_rpc</span><span class="p">(</span>
            <span class="s2">&quot;user_subscriptions_create&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;users&quot;</span><span class="p">:</span> <span class="n">users</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;success&quot;</span></div>

    <span class="k">def</span> <span class="nf">_build_opener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build urllib2 opener with appropriate proxy handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">NO_SSL_VALIDATION</span><span class="p">:</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CACertsHTTPSHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span><span class="p">:</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_handler</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="o">*</span><span class="n">handlers</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_certs_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ca_certs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The following method tells the API where to look for</span>
<span class="sd">        certificate authorities certificates (we will be referring to these</span>
<span class="sd">        as CAC from now on). Here&#39;s how the Python API interacts with those.</span>

<span class="sd">        Auth and CRUD operations</span>
<span class="sd">        ========================</span>
<span class="sd">        These operations are executed with httplib2. httplib2 ships with a</span>
<span class="sd">        list of CACs instead of asking Python&#39;s ssl module for them.</span>

<span class="sd">        Upload/Downloads</span>
<span class="sd">        ================</span>
<span class="sd">        These operations are executed using urllib2. urllib2 asks a Python</span>
<span class="sd">        module called `ssl` for CACs. We have bundled certifi with the API</span>
<span class="sd">        so that we can be sure the certs are correct at the time of the API</span>
<span class="sd">        release. This does however mean when the certs change we must update</span>
<span class="sd">        the API to contain the latest certifi.</span>
<span class="sd">        This approach is preferable to not using certifi since, on Windows,</span>
<span class="sd">        ssl searches for CACs in the Windows Certificate Store, on</span>
<span class="sd">        Linux/macOS, it asks the OpenSSL library linked with Python for CACs.</span>
<span class="sd">        Depending on how Python was compiled for a given DCC, Python may be</span>
<span class="sd">        linked against the OpenSSL from the OS or a copy of OpenSSL distributed</span>
<span class="sd">        with the DCC. This impacts which versions of the certificates are</span>
<span class="sd">        available to Python, as an OS level OpenSSL will be aware of system</span>
<span class="sd">        wide certificates that have been added, while an OpenSSL that comes</span>
<span class="sd">        with a DCC is likely bundling a list of certificates that get update</span>
<span class="sd">        with each release and may not contain system wide certificates.</span>

<span class="sd">        Using custom CACs</span>
<span class="sd">        =================</span>
<span class="sd">        When a user requires a non-standard CAC, the SHOTGUN_API_CACERTS</span>
<span class="sd">        environment variable allows to provide an alternate location for</span>
<span class="sd">        the CACs.</span>

<span class="sd">        :param ca_certs: A default cert can be provided</span>
<span class="sd">        :return: The cert file path to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ca_certs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># certs were provided up front so use these</span>
            <span class="k">return</span> <span class="n">ca_certs</span>
        <span class="k">elif</span> <span class="s2">&quot;SHOTGUN_API_CACERTS&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SHOTGUN_API_CACERTS&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No certs have been specifically provided fallback to using the</span>
            <span class="c1"># certs shipped with this API.</span>
            <span class="c1"># We bundle certifi with this API so that we have a higher chance</span>
            <span class="c1"># of using an uptodate certificate, rather than relying</span>
            <span class="c1"># on the certs that are bundled with Python or the OS in some cases.</span>
            <span class="c1"># However we can&#39;t use certifi.where() since that searches for the</span>
            <span class="c1"># cacert.pem file using the sys.path and this means that if another</span>
            <span class="c1"># copy of certifi can be found first, then it won&#39;t use ours.</span>
            <span class="c1"># So we manually generate the path to the cert, but still use certifi</span>
            <span class="c1"># to make it easier for updating the bundled cert with the API.</span>
            <span class="n">cur_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
            <span class="c1"># Now add the rest of the path to the cert file.</span>
            <span class="n">cert_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;certifi&quot;</span><span class="p">,</span> <span class="s2">&quot;cacert.pem&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cert_file</span>

    <span class="k">def</span> <span class="nf">_turn_off_ssl_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn off SSL certificate validation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">NO_SSL_VALIDATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">NO_SSL_VALIDATION</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># reset ssl-validation in user-agents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ssl </span><span class="si">%s</span><span class="s2"> (no-validate)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">ssl_version</span>
                             <span class="k">if</span> <span class="n">ua</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ssl &quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">ua</span>
                             <span class="k">for</span> <span class="n">ua</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">]</span>

    <span class="c1"># Deprecated methods from old wrapper</span>
<div class="viewcode-block" id="Shotgun.schema"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.schema">[docs]</a>    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 3.0.0</span>
<span class="sd">           Use :meth:`~shotgun_api3.Shotgun.schema_field_read` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Deprecated: use schema_field_read(&#39;</span><span class="si">%s</span><span class="s2">&#39;) instead&quot;</span> <span class="o">%</span> <span class="n">entity_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="Shotgun.entity_types"><a class="viewcode-back" href="../../reference.html#shotgun_api3.shotgun.Shotgun.entity_types">[docs]</a>    <span class="k">def</span> <span class="nf">entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 3.0.0</span>
<span class="sd">           Use :meth:`~shotgun_api3.Shotgun.schema_entity_read` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Deprecated: use schema_entity_read() instead&quot;</span><span class="p">)</span></div>
    <span class="c1"># ========================================================================</span>
    <span class="c1"># RPC Functions</span>

    <span class="k">def</span> <span class="nf">_call_rpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the specified method on the Shotgun Server sending the supplied payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Starting rpc call to </span><span class="si">%s</span><span class="s2"> with params </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_outbound</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_payload</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="n">include_auth_params</span><span class="p">)</span>
        <span class="n">encoded_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="n">req_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;connection&quot;</span><span class="p">:</span> <span class="s2">&quot;keep-alive&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">localized</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">req_headers</span><span class="p">[</span><span class="s2">&quot;locale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>

        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ATTEMPTS</span><span class="p">:</span>
            <span class="n">http_status</span><span class="p">,</span> <span class="n">resp_headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call</span><span class="p">(</span>
                <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_path</span><span class="p">,</span>
                <span class="n">encoded_payload</span><span class="p">,</span>
                <span class="n">req_headers</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed rpc call to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_http_status</span><span class="p">(</span><span class="n">http_status</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">resp_headers</span>

                <span class="c1"># We&#39;ve seen some rare instances of PTR returning 502 for issues that</span>
                <span class="c1"># appear to be caused by something internal to PTR. We&#39;re going to</span>
                <span class="c1"># allow for limited retries for those specifically.</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ATTEMPTS</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">errcode</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">502</span><span class="p">,</span> <span class="mi">504</span><span class="p">]:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got a 502 or 504 response. Waiting and retrying...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACKOFF</span><span class="p">)</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">errcode</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                    <span class="c1"># 403 is returned with custom error page when api access is blocked</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">errmsg</span> <span class="o">+=</span> <span class="s2">&quot;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">body</span>
                <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_response</span><span class="p">(</span><span class="n">resp_headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_response_errors</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_inbound</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;results&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_auth_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary of the authentication parameters being used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Used to authenticate HumanUser credentials</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;user_login&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_login</span><span class="p">),</span>
                <span class="s2">&quot;user_password&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">user_password</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span><span class="p">:</span>
                <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;auth_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">auth_token</span><span class="p">)</span>

        <span class="c1"># Use script name instead</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;script_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">script_name</span><span class="p">),</span>
                <span class="s2">&quot;script_key&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">api_key</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="c1"># Authenticate using session_id</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Session token based authentication requires server version &quot;</span>
                                   <span class="s2">&quot;5.3.0 or higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>

            <span class="n">auth_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;session_token&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_token</span><span class="p">)}</span>

            <span class="c1"># Request server side to raise exception for expired sessions.</span>
            <span class="c1"># This was added in as part of Shotgun 5.4.4</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;reject_if_expired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid auth params&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span><span class="p">:</span>
            <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;session_uuid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">session_uuid</span>

        <span class="c1"># Make sure sudo_as_login is supported by server version</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Option &#39;sudo_as_login&#39; requires server version 5.3.12 or &quot;</span>
                                   <span class="s2">&quot;higher, server is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span><span class="p">,))</span>
            <span class="n">auth_params</span><span class="p">[</span><span class="s2">&quot;sudo_as_login&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sudo_as_login</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">extra_auth_params</span><span class="p">:</span>
            <span class="n">auth_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">extra_auth_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">auth_params</span>

    <span class="k">def</span> <span class="nf">_sanitize_auth_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an authentication parameter dictionary, sanitize any sensitive</span>
<span class="sd">        information and return the sanitized dict copy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sanitized_params</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;user_password&quot;</span><span class="p">,</span> <span class="s2">&quot;script_key&quot;</span><span class="p">,</span> <span class="s2">&quot;session_token&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sanitized_params</span><span class="p">:</span>
                <span class="n">sanitized_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;********&quot;</span>
        <span class="k">return</span> <span class="n">sanitized_params</span>

    <span class="k">def</span> <span class="nf">_build_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">include_auth_params</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the payload to be send to the rpc endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method is empty&quot;</span><span class="p">)</span>

        <span class="n">call_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">include_auth_params</span><span class="p">:</span>
            <span class="n">auth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">()</span>
            <span class="n">call_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">call_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">call_params</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_encode_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Encode the payload to a string to be passed to the rpc endpoint.</span>

<span class="sd">        The payload is json encoded as a unicode string if the content</span>
<span class="sd">        requires it. The unicode string is then encoded as &#39;utf-8&#39; as it must</span>
<span class="sd">        be in a single byte encoding to go over the wire.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wire</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="n">wire</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an HTTP call to the server.</span>

<span class="sd">        Handles retry and failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_headers</span><span class="p">[</span><span class="s2">&quot;user-agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span><span class="p">:</span>
            <span class="n">req_headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">authorization</span>

        <span class="n">req_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span> <span class="ow">or</span> <span class="kc">None</span>

        <span class="n">max_rpc_attempts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_rpc_attempts</span>
        <span class="n">rpc_attempt_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rpc_attempt_interval</span> <span class="o">/</span> <span class="mf">1000.0</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_rpc_attempts</span><span class="p">):</span>
            <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_request</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">req_headers</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLEOFError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># SG-34910 - EOF occurred in violation of protocol (_ssl.c:2426)</span>
                <span class="c1"># This issue seems to be related to proxy and keep alive.</span>
                <span class="c1"># It looks like, sometimes, the proxy drops the connection on</span>
                <span class="c1"># the TCP/TLS level despites the keep-alive. So we need to close</span>
                <span class="c1"># the connection and make a new attempt.</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SSLEOFError: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_rpc_attempts</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request failed.  Giving up after </span><span class="si">%d</span><span class="s2"> attempts.&quot;</span> <span class="o">%</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="c1"># This is the exact same block as the &quot;except Exception&quot; bellow.</span>
                <span class="c1"># We need to do it here because the next except will match it</span>
                <span class="c1"># otherwise and will not re-attempt.</span>
                <span class="c1"># When we drop support of Python 2 and we will probably drop the</span>
                <span class="c1"># next except, we might want to remove this except too.</span>
            <span class="k">except</span> <span class="n">ssl_error_classes</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Test whether the exception is due to the fact that this is an older version of</span>
                <span class="c1"># Python that cannot validate certificates encrypted with SHA-2. If it is, then</span>
                <span class="c1"># fall back on disabling the certificate validation and try again - unless the</span>
                <span class="c1"># SHOTGUN_FORCE_CERTIFICATE_VALIDATION environment variable has been set by the</span>
                <span class="c1"># user. In that case we simply raise the exception. Any other exceptions simply</span>
                <span class="c1"># get raised as well.</span>
                <span class="c1">#</span>
                <span class="c1"># For more info see:</span>
                <span class="c1"># https://www.shotgridsoftware.com/blog/important-ssl-certificate-renewal-and-sha-2/</span>
                <span class="c1">#</span>
                <span class="c1"># SHA-2 errors look like this:</span>
                <span class="c1">#   [Errno 1] _ssl.c:480: error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:</span>
                <span class="c1">#   unknown message digest algorithm</span>
                <span class="c1">#</span>
                <span class="c1"># Any other exceptions simply get raised.</span>
                <span class="k">if</span> <span class="s2">&quot;unknown message digest algorithm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">or</span> \
                   <span class="s2">&quot;SHOTGUN_FORCE_CERTIFICATE_VALIDATION&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                    <span class="k">raise</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;SSL Error: this Python installation is incompatible with &quot;</span>
                                <span class="s2">&quot;certificates signed with SHA-2. Disabling certificate validation. &quot;</span>
                                <span class="s2">&quot;For more information, see https://www.shotgridsoftware.com/blog/&quot;</span>
                                <span class="s2">&quot;important-ssl-certificate-renewal-and-sha-2/&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_turn_off_ssl_validation</span><span class="p">()</span>
                    <span class="c1"># reload user agent to reflect that we have turned off ssl validation</span>
                    <span class="n">req_headers</span><span class="p">[</span><span class="s2">&quot;user-agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_agents</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_rpc_attempts</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request failed.  Giving up after </span><span class="si">%d</span><span class="s2"> attempts.&quot;</span> <span class="o">%</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_close_connection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_rpc_attempts</span><span class="p">:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request failed.  Giving up after </span><span class="si">%d</span><span class="s2"> attempts.&quot;</span> <span class="o">%</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="k">raise</span>

            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Request failed, attempt </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2">.  Retrying in </span><span class="si">%.2f</span><span class="s2"> seconds...&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">attempt</span><span class="p">,</span> <span class="n">max_rpc_attempts</span><span class="p">,</span> <span class="n">rpc_attempt_interval</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">rpc_attempt_interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_http_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make the actual HTTP request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request is </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">verb</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request headers are </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request body is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">body</span><span class="p">)</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_connection</span><span class="p">()</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">content</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="c1"># http response code is handled else where</span>
        <span class="n">http_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
        <span class="n">resp_headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">resp_body</span> <span class="o">=</span> <span class="n">content</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response status is </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">http_status</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response headers are </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">resp_headers</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response body is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">resp_body</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">http_status</span><span class="p">,</span> <span class="n">resp_headers</span><span class="p">,</span> <span class="n">resp_body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_upload_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">opener</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open the given request object, return the</span>
<span class="sd">        response, raises URLError on protocol errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_parse_http_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the status returned from the http request.</span>

<span class="sd">        :param tuple status: Tuple of (code, reason).</span>
<span class="sd">        :raises: RuntimeError if the http status is non success.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_code</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">errmsg</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;HTTP error from server&quot;</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">503</span><span class="p">:</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Flow Production Tracking is currently down for maintenance or too busy to reply. Please try again later.&quot;</span>
            <span class="k">raise</span> <span class="n">ProtocolError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                <span class="n">error_code</span><span class="p">,</span>
                                <span class="n">errmsg</span><span class="p">,</span>
                                <span class="n">headers</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_decode_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode the response from the server from the wire format to</span>
<span class="sd">        a python data structure.</span>

<span class="sd">        :param dict headers: Headers from the server.</span>
<span class="sd">        :param str body: Raw response body from the server.</span>
<span class="sd">        :returns: If the content-type starts with application/json or</span>
<span class="sd">            text/javascript the body is json decoded. Otherwise the raw body is</span>
<span class="sd">            returned.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">body</span>

        <span class="n">ct</span> <span class="o">=</span> <span class="p">(</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ct</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ct</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;text/javascript&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">def</span> <span class="nf">_json_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_loads_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See http://stackoverflow.com/questions/956867</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_decode_list</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="n">newlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">_decode_list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">newlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">newlist</span>

        <span class="k">def</span> <span class="nf">_decode_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
            <span class="n">newdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">_decode_list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">newdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">return</span> <span class="n">newdict</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">_decode_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_response_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg_response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise any API errors specified in the response.</span>

<span class="sd">        :raises ShotgunError: If the server response contains an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># error code for authentication related problems</span>
        <span class="n">ERR_AUTH</span> <span class="o">=</span> <span class="mi">102</span>
        <span class="c1"># error code when 2FA authentication is required but no 2FA token provided.</span>
        <span class="n">ERR_2FA</span> <span class="o">=</span> <span class="mi">106</span>
        <span class="c1"># error code when SSO is activated on the site, preventing the use of username/password for authentication.</span>
        <span class="n">ERR_SSO</span> <span class="o">=</span> <span class="mi">108</span>
        <span class="c1"># error code when Oxygen is activated on the site, preventing the use of username/password for authentication.</span>
        <span class="n">ERR_OXYG</span> <span class="o">=</span> <span class="mi">110</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exception&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_AUTH</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthenticationFault</span><span class="p">(</span><span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown Authentication Error&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_2FA</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MissingTwoFactorAuthenticationFault</span><span class="p">(</span>
                    <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown 2FA Authentication Error&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_SSO</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserCredentialsNotAllowedForSSOAuthenticationFault</span><span class="p">(</span>
                    <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;Authentication using username/password is not &quot;</span>
                                    <span class="s2">&quot;allowed for an SSO-enabled Flow Production Tracking site&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ERR_OXYG</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserCredentialsNotAllowedForOxygenAuthenticationFault</span><span class="p">(</span>
                    <span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Authentication using username/password is not &quot;</span>
                                    <span class="s2">&quot;allowed for an Autodesk Identity enabled Flow Production Tracking site&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># raise general Fault</span>
                <span class="k">raise</span> <span class="n">Fault</span><span class="p">(</span><span class="n">sg_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown Error&quot;</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_visit_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">visitor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Walk the data (simple python types) and call the visitor.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="n">recursive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">recursive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">recursive</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">visitor</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">recursive</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">visitor</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">visitor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transform_outbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform data types or values before they are sent by the client.</span>

<span class="sd">        - changes timezones</span>
<span class="sd">        - converts dates and times to strings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">tzinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">local</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_change_tz</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">local_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_outbound_visitor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="c1"># existing code did not tz transform dates.</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">local_now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">hour</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                    <span class="n">minute</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
                    <span class="n">second</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
                    <span class="n">microsecond</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">microsecond</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

            <span class="c1"># ensure return is six.text_type</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_outbound_visitor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_transform_inbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms data types or values after they are received from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: The time zone is removed from the time after it is transformed</span>
        <span class="c1"># to the local time, otherwise it will fail to compare to datetimes</span>
        <span class="c1"># that do not have a time zone.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">convert_datetimes_to_utc</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_change_tz</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">SG_TIMEZONE</span><span class="o">.</span><span class="n">local</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_change_tz</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">_inbound_visitor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">20</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATE_TIME_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># strptime was not on datetime in python2.4</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
                            <span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)[:</span><span class="mi">6</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="n">_change_tz</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">_change_tz</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">value</span>

            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visit_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_inbound_visitor</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
    <span class="c1"># Connection Functions</span>

    <span class="k">def</span> <span class="nf">_get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the current connection or creates a new connection to the current server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">ProxyInfo</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_HTTP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_server</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_port</span><span class="p">,</span> <span class="n">proxy_user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_user</span><span class="p">,</span>
                           <span class="n">proxy_pass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">proxy_pass</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">Http</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_secs</span><span class="p">,</span> <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span>
                                    <span class="n">proxy_info</span><span class="o">=</span><span class="n">pi</span><span class="p">,</span> <span class="n">disable_ssl_certificate_validation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">Http</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">timeout_secs</span><span class="p">,</span> <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span>
                                    <span class="n">proxy_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">disable_ssl_certificate_validation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">no_ssl_validation</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span>

    <span class="k">def</span> <span class="nf">_close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the current connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
    <span class="c1"># ========================================================================</span>
    <span class="c1"># Utility</span>

    <span class="k">def</span> <span class="nf">_parse_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse &#39;records&#39; returned from the api to do local modifications:</span>

<span class="sd">        - Insert thumbnail urls</span>
<span class="sd">        - Insert local file paths.</span>
<span class="sd">        - Revert &amp;lt; html entities that may be the result of input sanitization</span>
<span class="sd">          mechanisms back to a litteral &lt; character.</span>

<span class="sd">        :param records: List of records (dicts) to process or a single record.</span>

<span class="sd">        :returns: A list of the records processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">records</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">records</span><span class="p">,</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
            <span class="c1"># skip results that aren&#39;t entity dictionaries</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># iterate over each item and check each field for possible injection</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">rec</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check for html entities in strings</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">)</span>

                <span class="c1"># check for thumbnail for older version (&lt;3.3.0) of shotgun</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_caps</span><span class="o">.</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_thumb_url</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">rec</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;link_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">local_path_field</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">local_path</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">client_caps</span><span class="o">.</span><span class="n">local_path_field</span><span class="p">]</span>
                    <span class="n">v</span><span class="p">[</span><span class="s2">&quot;local_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_path</span>
                    <span class="n">v</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;file://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">local_path</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">_build_thumb_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the URL for the thumbnail of an entity given the entity type and the entity id.</span>

<span class="sd">        Note: This makes a call to the server for every thumbnail.</span>

<span class="sd">        :param entity_type: Entity type the id is for.</span>
<span class="sd">        :param entity_id: id of the entity to get the thumbnail for.</span>
<span class="sd">        :returns: Fully qualified url to the thumbnail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Example response from the end point</span>
        <span class="c1"># curl &quot;https://foo.com/upload/get_thumbnail_url?entity_type=Version&amp;entity_id=1&quot;</span>
        <span class="c1"># 1</span>
        <span class="c1"># /files/0000/0000/0012/232/shot_thumb.jpg.jpg</span>
        <span class="n">entity_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;e_type&quot;</span><span class="p">:</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">entity_type</span><span class="p">),</span>
                       <span class="s2">&quot;e_id&quot;</span><span class="p">:</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entity_id</span><span class="p">))}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/upload/get_thumbnail_url?&quot;</span> <span class="o">+</span>
               <span class="s2">&quot;entity_type=</span><span class="si">%(e_type)s</span><span class="s2">&amp;entity_id=</span><span class="si">%(e_id)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">entity_info</span><span class="p">)</span>

        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">code</span><span class="p">,</span> <span class="n">thumb_url</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># code of 0 means error, second line is the error code</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="n">thumb_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                            <span class="n">thumb_url</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                            <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Comments in prev version said we can get this sometimes.</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unknown code </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">thumb_url</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_dict_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s2">&quot;field_name&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">extra_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility function to convert a dict into a list dicts using the key_name and value_name keys.</span>

<span class="sd">        e.g. d {&#39;foo&#39; : &#39;bar&#39;} changed to [{&#39;field_name&#39;:&#39;foo&#39;, &#39;value&#39;:&#39;bar&#39;}]</span>

<span class="sd">        Any dictionary passed in via extra_data will be merged into the resulting dictionary.</span>
<span class="sd">        e.g. d as above and extra_data of {&#39;foo&#39;: {&#39;thing1&#39;: &#39;value1&#39;}} changes into</span>
<span class="sd">        [{&#39;field_name&#39;: &#39;foo&#39;, &#39;value&#39;: &#39;bar&#39;, &#39;thing1&#39;: &#39;value1&#39;}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">((</span><span class="n">d</span> <span class="ow">or</span> <span class="p">{})):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">key_name</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">extra_data</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_dict_to_extra_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility function to convert a dict into a dict compatible with the extra_data arg</span>
<span class="sd">        of _dict_to_list.</span>

<span class="sd">        e.g. d {&#39;foo&#39; : &#39;bar&#39;} changed to {&#39;foo&#39;: {&quot;value&quot;: &#39;bar&#39;}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="p">{</span><span class="n">key_name</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">((</span><span class="n">d</span> <span class="ow">or</span> <span class="p">{}))])</span>

    <span class="k">def</span> <span class="nf">_upload_file_to_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">storage_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to upload an entire file to the Cloud storage.</span>

<span class="sd">        :param str path: Full path to an existing non-empty file on disk to upload.</span>
<span class="sd">        :param str storage_url: Target URL for the uploaded file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">fileno</span><span class="p">())[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_SIZE</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_data_to_storage</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">storage_url</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File uploaded to Cloud storage: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_multipart_upload_file_to_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to upload a file to the Cloud storage in multiple parts.</span>

<span class="sd">        :param str path: Full path to an existing non-empty file on disk to upload.</span>
<span class="sd">        :param dict upload_info: Contains details received from the server, about the upload.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">fileno</span><span class="p">())[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_SIZE</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">etags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">part_number</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MULTIPART_UPLOAD_CHUNK_SIZE</span>
            <span class="k">while</span> <span class="n">bytes_read</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
                <span class="n">data_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1"># keep data as a stream so that we don&#39;t need to worry how it was</span>
                <span class="c1"># encoded.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">bytes_read</span> <span class="o">+=</span> <span class="n">data_size</span>
                <span class="n">part_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_upload_part_link</span><span class="p">(</span><span class="n">upload_info</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">part_number</span><span class="p">)</span>
                <span class="n">etags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_data_to_storage</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">part_url</span><span class="p">))</span>
                <span class="n">part_number</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_complete_multipart_upload</span><span class="p">(</span><span class="n">upload_info</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">etags</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;File uploaded in multiple parts to Cloud storage: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_upload_part_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">part_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to get the url to upload the next part of a file to the</span>
<span class="sd">        Cloud storage, in a multi-part upload process.</span>

<span class="sd">        :param dict upload_info: Contains details received from the server, about the upload.</span>
<span class="sd">        :param str filename: Name of the file for which we want the link.</span>
<span class="sd">        :param int part_number: Part number for the link.</span>
<span class="sd">        :returns: upload url.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;upload_type&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="s2">&quot;upload_id&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;part_number&quot;</span><span class="p">:</span> <span class="n">part_number</span>
        <span class="p">}</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                       <span class="s2">&quot;/upload/api_get_upload_link_for_part&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="c1"># Response is of the form: 1\n&lt;url&gt; (for success) or 0\n (for failure).</span>
        <span class="c1"># In case of success, we know we the second line of the response contains the</span>
        <span class="c1"># requested URL.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Unable get upload part link: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got next upload link from server for multipart upload.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_upload_data_to_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">storage_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to upload data to Cloud storage.</span>

<span class="sd">        :param stream data: Contains details received from the server, about the upload.</span>
<span class="sd">        :param str content_type: Content type of the data stream.</span>
<span class="sd">        :param int size: Number of bytes in the data stream.</span>
<span class="sd">        :param str storage_url: Target URL for the uploaded file.</span>
<span class="sd">        :returns: upload url.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">storage_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">get_method</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;PUT&quot;</span>

        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ATTEMPTS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_upload_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">opener</span><span class="p">)</span>

                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Completed request to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">get_method</span><span class="p">())</span>

            <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ATTEMPTS</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">503</span><span class="p">]:</span>
                    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got a </span><span class="si">%s</span><span class="s2"> response. Waiting and retrying...&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACKOFF</span><span class="p">)</span>
                    <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">503</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Got a </span><span class="si">%s</span><span class="s2"> response when uploading to </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">storage_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Unanticipated error occurred uploading to </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">storage_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got a &#39;</span><span class="si">%s</span><span class="s2">&#39; response. Waiting and retrying...&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACKOFF</span><span class="p">)</span>
                <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Max attemps limit reached.&quot;</span><span class="p">)</span>

        <span class="n">etag</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">()[</span><span class="s2">&quot;Etag&quot;</span><span class="p">]</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Part upload completed successfully.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">etag</span>

    <span class="k">def</span> <span class="nf">_complete_multipart_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload_info</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">etags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to complete a multi-part upload to the Cloud storage.</span>

<span class="sd">        :param dict upload_info: Contains details received from the server, about the upload.</span>
<span class="sd">        :param str filename: Name of the file for which we want to complete the upload.</span>
<span class="sd">        :param tupple etags: Contains the etag of each uploaded file part.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;upload_type&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="s2">&quot;upload_id&quot;</span><span class="p">:</span> <span class="n">upload_info</span><span class="p">[</span><span class="s2">&quot;upload_id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;etags&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">etags</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                       <span class="s2">&quot;/upload/api_complete_multipart_upload&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="c1"># Response is of the form: 1\n or 0\n to indicate success or failure of the call.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Unable get upload part link: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_requires_direct_s3_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function that determines if an entity_type + field_name combination</span>
<span class="sd">        should be uploaded to cloud storage.</span>

<span class="sd">        The info endpoint should return `s3_enabled_upload_types` which contains an object like the following:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;Version&#39;: [&#39;sg_uploaded_movie&#39;],</span>
<span class="sd">                &#39;Attachment&#39;: &#39;*&#39;,</span>
<span class="sd">                &#39;*&#39;: [&#39;this_file&#39;]</span>
<span class="sd">            }</span>

<span class="sd">        :param str entity_type: The entity type of the file being uploaded.</span>
<span class="sd">        :param str field_name: The matching field name for the file being uploaded.</span>

<span class="sd">        :returns: Whether the field + entity type combination should be uploaded to cloud storage.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">supported_s3_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s3_enabled_upload_types&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">supported_fields</span> <span class="o">=</span> <span class="n">supported_s3_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">supported_star_fields</span> <span class="o">=</span> <span class="n">supported_s3_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="c1"># If direct uploads are enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;s3_direct_uploads_enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="c1"># If field_name is part of a supported entity_type</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">supported_fields</span> <span class="ow">or</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">supported_star_fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1"># If supported_fields is a string or a list with *</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">supported_fields</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">supported_fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">supported_fields</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1"># If supported_star_fields is a list containing * or * as a string</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">supported_star_fields</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">supported_star_fields</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">supported_star_fields</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1"># Support direct upload for old versions of shotgun</span>
            <span class="k">return</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;Version&quot;</span> <span class="ow">and</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;sg_uploaded_movie&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_send_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility function to send a Form to Shotgun and process any HTTP errors that</span>
<span class="sd">        could occur.</span>

<span class="sd">        :param url: endpoint where the form is sent.</span>
<span class="sd">        :param params: form data</span>
<span class="sd">        :returns: result from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_params</span><span class="p">())</span>

        <span class="n">opener</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_opener</span><span class="p">(</span><span class="n">FormPostHandler</span><span class="p">)</span>

        <span class="n">attempt</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">attempt</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_ATTEMPTS</span><span class="p">:</span>
            <span class="c1"># Perform the request</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="c1"># response headers are in str(resp.info()).splitlines()</span>
            <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got a </span><span class="si">%s</span><span class="s2"> response. Waiting and retrying...&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">BACKOFF</span><span class="p">)</span>
                <span class="n">attempt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Server encountered an internal error. &quot;</span>
                                    <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_auth_params</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Unanticipated error occurred </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Max attemps limit reached.&quot;</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">CACertsHTTPSConnection</span><span class="p">(</span><span class="n">http_client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    This class allows to create an HTTPS connection that uses the custom certificates</span>
<span class="sd">    passed in.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_port</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">HTTPS_PORT</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param args: Positional arguments passed down to the base class.</span>
<span class="sd">        :param ca_certs: Path to the custom CA certs file.</span>
<span class="sd">        :param kwargs: Keyword arguments passed down to the bas class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pop that argument,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ca_certs&quot;</span><span class="p">)</span>
        <span class="n">http_client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Connect to a host on a given (SSL) port.&quot;</span>
        <span class="n">http_client</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Now that the regular HTTP socket has been created, wrap it with our SSL certs.</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY38</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_CLIENT</span><span class="p">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
            <span class="n">context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span>
                <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span>
                <span class="n">cert_reqs</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
            <span class="p">)</span>


<span class="k">class</span> <span class="nc">CACertsHTTPSHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPSHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler that ensures https connections are created with the custom CA certs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cacerts</span><span class="p">):</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPSHandler</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span> <span class="o">=</span> <span class="n">cacerts</span>

    <span class="k">def</span> <span class="nf">https_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_https_connection</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_https_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CACertsHTTPSConnection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">ca_certs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__ca_certs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1"># Helpers from the previous API, left as is.</span>
<span class="c1"># Based on http://code.activestate.com/recipes/146306/</span>
<span class="k">class</span> <span class="nc">FormPostHandler</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">BaseHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for multipart form data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handler_order</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPHandler</span><span class="o">.</span><span class="n">handler_order</span> <span class="o">-</span> <span class="mi">10</span>  <span class="c1"># needs to run first</span>

    <span class="k">def</span> <span class="nf">http_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c1"># get_data was removed in 3.4. since we&#39;re testing against 3.6 and</span>
        <span class="c1"># 3.7, this should be sufficient.</span>
        <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">sgsix</span><span class="o">.</span><span class="n">file_types</span><span class="p">):</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>  <span class="c1"># sequencing on</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
                <span class="n">content_type</span> <span class="o">=</span> <span class="s2">&quot;multipart/form-data; boundary=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">boundary</span>
                <span class="n">request</span><span class="o">.</span><span class="n">add_unredirected_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
            <span class="c1"># add_data was removed in 3.4. since we&#39;re testing against 3.6 and</span>
            <span class="c1"># 3.7, this should be sufficient.</span>
            <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">boundary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Per https://stackoverflow.com/a/27174474</span>
            <span class="c1"># use a random string as the boundary if none was provided --</span>
            <span class="c1"># use uuid since mimetools no longer exists in Python 3.</span>
            <span class="c1"># We&#39;ll do this across both python 2/3 rather than add more branching.</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">buffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># If value is not a string (e.g. int) cast to text</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;--</span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">))</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;Content-Disposition: form-data; name=</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">))</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n\r\n</span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="c1"># On Windows, it&#39;s possible that we were forced to open a file</span>
            <span class="c1"># with non-ascii characters as unicode. In that case, we need to</span>
            <span class="c1"># encode it as a utf-8 string to remove unicode from the equation.</span>
            <span class="c1"># If we don&#39;t, the mix of unicode and strings going into the</span>
            <span class="c1"># buffer can cause UnicodeEncodeErrors to be raised.</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">name</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_text</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">content_type</span> <span class="ow">or</span> <span class="s2">&quot;application/octet-stream&quot;</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">fileno</span><span class="p">())[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_SIZE</span><span class="p">]</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;--</span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">))</span>
            <span class="n">c_dis</span> <span class="o">=</span> <span class="s2">&quot;Content-Disposition: form-data; name=</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">; filename=</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">c_dis</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="n">content_disposition</span><span class="p">))</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;Content-Type: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">content_type</span><span class="p">))</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;Content-Length: </span><span class="si">%s</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file_size</span><span class="p">))</span>

            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
            <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sgutils</span><span class="o">.</span><span class="n">ensure_binary</span><span class="p">(</span><span class="s2">&quot;--</span><span class="si">%s</span><span class="s2">--</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">))</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">buffer</span>

    <span class="k">def</span> <span class="nf">https_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_translate_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">filter_operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate filters params into data structure expected by rpc call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wrapped_filters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;filter_operator&quot;</span><span class="p">:</span> <span class="n">filter_operator</span> <span class="ow">or</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">_translate_filters_dict</span><span class="p">(</span><span class="n">wrapped_filters</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_translate_filters_dict</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">):</span>
    <span class="n">new_filters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">filter_operator</span> <span class="o">=</span> <span class="n">sg_filter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filter_operator&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
        <span class="n">new_filters</span><span class="p">[</span><span class="s2">&quot;logical_operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;and&quot;</span>
    <span class="k">elif</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s2">&quot;any&quot;</span> <span class="ow">or</span> <span class="n">filter_operator</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
        <span class="n">new_filters</span><span class="p">[</span><span class="s2">&quot;logical_operator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;or&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Invalid filter_operator </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filter_operator</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Invalid filters, expected a list or a tuple, got </span><span class="si">%s</span><span class="s2">&quot;</span>
                           <span class="o">%</span> <span class="n">sg_filter</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">])</span>

    <span class="n">new_filters</span><span class="p">[</span><span class="s2">&quot;conditions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_translate_filters_list</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">new_filters</span>


<span class="k">def</span> <span class="nf">_translate_filters_list</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">sg_filter</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_translate_filters_simple</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_translate_filters_dict</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ShotgunError</span><span class="p">(</span><span class="s2">&quot;Invalid filters, expected a list, tuple or dict, got </span><span class="si">%s</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="n">sg_filter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conditions</span>


<span class="k">def</span> <span class="nf">_translate_filters_simple</span><span class="p">(</span><span class="n">sg_filter</span><span class="p">):</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">sg_filter</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Payload optimization: Do not send a full object</span>
    <span class="c1"># just send the `type` and `id` when combining related queries</span>
    <span class="k">global</span> <span class="n">SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">SHOTGUN_API_ENABLE_ENTITY_OPTIMIZATION</span>
        <span class="ow">and</span> <span class="n">condition</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span>
        <span class="ow">and</span> <span class="n">condition</span><span class="p">[</span><span class="s2">&quot;relation&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;is_not&quot;</span><span class="p">]</span>
        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">condition</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">return</span> <span class="n">condition</span>


<span class="k">def</span> <span class="nf">_version_str</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a tuple of int&#39;s to a &#39;.&#39; separated str.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Autodesk.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 

  <script type="text/javascript">
    window.wafCCPAForceShow = true;
    (function(a,b,c,d){
      a='https://tags.tiqcdn.com/utag/autodesk/micro-basic/prod/utag.js';
      b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
      a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
    })();
  </script>


</body>
</html>