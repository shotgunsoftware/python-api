# Copyright (c) 2025 Shotgun Software Inc.
#
# CONFIDENTIAL AND PROPRIETARY
#
# This work is provided "AS IS" and subject to the Shotgun Pipeline Toolkit
# Source Code License included in this distribution package. See LICENSE.
# By accessing, using, copying or modifying this work you indicate your
# agreement to the Shotgun Pipeline Toolkit Source Code License. All rights
# not expressly granted therein are reserved by Shotgun Software Inc.

parameters:
  # Git ref of tk-toolchain to use.
  tk_toolchain_ref: master
  # Git ref of tk-core to use.
  tk_core_ref: master


jobs:
- job: build_documentation
  displayName: Build Sphinx Documentation
  pool:
    vmImage: ubuntu-latest

  steps:
  - task: UsePythonVersion@0
    displayName: Use Python 3.10
    inputs:
      versionSpec: 3.10

## TODO switch to Py 3.11 Pyside6

  - task: Bash@3
    displayName: Install Python dependencies
    inputs:
      targetType: inline
      script: |
        pip install --upgrade pip
        pip install --upgrade setuptools wheel
        pip install --upgrade \
          PySide2 \
          https://github.com/shotgunsoftware/tk-toolchain/archive/${{ parameters.tk_toolchain_ref }}.zip

  - task: Bash@3
    displayName: Clone the tk-core repository
    inputs:
      targetType: inline
      script: |
        git clone --depth 1 \
          --branch ${{ parameters.tk_core_ref }} \
          https://github.com/shotgunsoftware/tk-core \
          ../tk-core

  - task: Bash@3
    displayName: Build Shpinx Documentation
    inputs:
      targetType: inline
      script: tk-docs-preview --build-only --verbose
