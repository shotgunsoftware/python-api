# We've stored some variables in Azure. They contain credentials
# and are encrypted. They are also not available to clients.
# This statement says which variable groups this repo requires.
# We have two: one that can be shared by all repos that use CI
# and another that is used just by the Python API, which creates
# HumanUser's and as such need a password, which we can't
# hardcode in the .yml files.
variables:
  group: ci-credentials
  group: python-api

# This here is the list of jobs we want to run for our build.
# Jobs run in parallel.
jobs:

# This is our first job and it lints our code.
- job: Linting
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  # Use Python 3 for linting because it is faster ;)
  - task: UsePythonVersion@0
    inputs:
      versionSpec: 3.x
      addToPath: True

  # Make sure everything is up to date for linting.
  - script: |
      python -m pip install --upgrade pip setuptools wheel
      python -m pip install flake8
    displayName: 'Install tools'

  # Lints the code!
  - script: python -m flake8
    displayName: 'Linting'

# These are jobs templates, they allow to reduce the redundancy between
# variations of the same build. We pass in the image name
# and a friendly name that then template can then use to create jobs.
- template: azure-pipelines-templates/run-tests.yml
  parameters:
    name: Linux
    vm_image: 'ubuntu-16.04'

- template: azure-pipelines-templates/run-tests.yml
  parameters:
    name: macOS
    vm_image: 'macOS-10.13'

- template: azure-pipelines-templates/run-tests.yml
  parameters:
    name: Windows
    vm_image: 'vs2017-win2016'
